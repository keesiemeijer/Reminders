import{b as De,w as fe,K as A,x as te,y as Ce,z as _e,A as Le,r as u,j as t,B as ie,L as W,C as ve,D as se,E as Ne,e as he,G as B,H as ae,I as we,J as Se,M as le,N as Te,O as ke,P as Re,S as $e,Q as Ae,U as Ee,V as He,W as Oe,X as re,Y as pe,m as Me,Z as Pe,$ as Be,a0 as qe,a1 as oe,a2 as Fe,T as Ue,c as We,n as Ve,o as Ke,a3 as Ze,p as Je,a4 as ce,a5 as de,a6 as Xe}from"./index-_4ZB8lTO.js";import{C as ge,a as Ye,H as ze}from"./history-nav-BTiB_Uf9.js";import{u as X}from"./useTranslation-CSL3NNR0.js";const xe=e=>{const[a]=De();if(!a.has("id"))return 0;const r=a.get("id");let l=typeof r=="string"?+r:0;const c=fe(e);return l&&!isNaN(l)&&c.includes(l)?l:0},Ge=e=>{const a=e.map(r=>r.depth);return Math.min(...a)},Qe=e=>{const a=Ge(e);return e.map(l=>(l.depth=l.depth-a,l))},et=[A.Down,A.Right,A.Up,A.Left],tt=[A.Left,A.Right],st=(e,a,r)=>(l,{currentCoordinates:c,context:{active:s,over:n,collisionRect:f,droppableRects:x,droppableContainers:I}})=>{if(et.includes(l.code)){if(!s||!f)return;l.preventDefault();const{current:{items:p,offset:v}}=e;if(tt.includes(l.code)&&(n!=null&&n.id)){const{depth:o,maxDepth:g,minDepth:m}=te(p,s.id,n.id,v,r);switch(l.code){case A.Left:if(o>m)return{...c,x:c.x-r};break;case A.Right:if(o<g)return{...c,x:c.x+r};break}return}const j=[];I.forEach(o=>{if(o!=null&&o.disabled||o.id===(n==null?void 0:n.id))return;const g=x.get(o.id);if(g)switch(l.code){case A.Down:f.top<g.top&&j.push(o);break;case A.Up:f.top>g.top&&j.push(o);break}});const D=Ce({collisionRect:f,droppableRects:x,droppableContainers:j});let b=_e(D,"id");if(b===(n==null?void 0:n.id)&&D.length>1&&(b=D[1].id),b&&(n!=null&&n.id)){const o=x.get(s.id),g=x.get(b),m=I.get(b);if(o&&g&&m){const h=p.findIndex(({id:$})=>$===b),w=p[h],S=p.findIndex(({id:$})=>$===s.id),T=p[S];if(w&&T){const{depth:$}=te(p,s.id,b,(w.depth-T.depth)*r,r),O=h>S?1:-1,q=a?(f.height-o.height)/2:0;return{x:g.left+$*r,y:g.top+O*q}}}}}};var ee={exports:{}};/*!
	Copyright (c) 2018 Jed Watson.
	Licensed under the MIT License (MIT), see
	http://jedwatson.github.io/classnames
*/var ue;function nt(){return ue||(ue=1,function(e){(function(){var a={}.hasOwnProperty;function r(){for(var s="",n=0;n<arguments.length;n++){var f=arguments[n];f&&(s=c(s,l(f)))}return s}function l(s){if(typeof s=="string"||typeof s=="number")return s;if(typeof s!="object")return"";if(Array.isArray(s))return r.apply(null,s);if(s.toString!==Object.prototype.toString&&!s.toString.toString().includes("[native code]"))return s.toString();var n="";for(var f in s)a.call(s,f)&&s[f]&&(n=c(n,f));return n}function c(s,n){return n?s?s+" "+n:s+n:s}e.exports?(r.default=r,e.exports=r):window.classNames=r})()}(ee)),ee.exports}var it=nt();const V=Le(it),at="_Action_4wa11_1",lt={Action:at},ne=u.forwardRef(({active:e,className:a,cursor:r,style:l,...c},s)=>t.jsx("button",{ref:s,...c,className:"btn-handle "+V(lt.Action,a),tabIndex:0,style:{...l,cursor:r,"--fill":e==null?void 0:e.fill,"--background":e==null?void 0:e.background}})),Ie=u.forwardRef((e,a)=>t.jsx(ne,{ref:a,cursor:"grab","data-cypress":"draggable-handle",...e}));function rt(e){return t.jsx(ne,{...e,active:{fill:"rgba(255, 70, 70, 0.95)",background:"rgba(255, 70, 70, 0.1)"},children:t.jsx("svg",{width:"8",viewBox:"0 0 22 22",xmlns:"http://www.w3.org/2000/svg",children:t.jsx("path",{d:"M2.99998 -0.000206962C2.7441 -0.000206962 2.48794 0.0972617 2.29294 0.292762L0.292945 2.29276C-0.0980552 2.68376 -0.0980552 3.31682 0.292945 3.70682L7.58591 10.9998L0.292945 18.2928C-0.0980552 18.6838 -0.0980552 19.3168 0.292945 19.7068L2.29294 21.7068C2.68394 22.0978 3.31701 22.0978 3.70701 21.7068L11 14.4139L18.2929 21.7068C18.6829 22.0978 19.317 22.0978 19.707 21.7068L21.707 19.7068C22.098 19.3158 22.098 18.6828 21.707 18.2928L14.414 10.9998L21.707 3.70682C22.098 3.31682 22.098 2.68276 21.707 2.29276L19.707 0.292762C19.316 -0.0982383 18.6829 -0.0982383 18.2929 0.292762L11 7.58573L3.70701 0.292762C3.51151 0.0972617 3.25585 -0.000206962 2.99998 -0.000206962Z"})})})}const ot="_Wrapper_1ubmq_31",ct="_fadeIn_1ubmq_38",dt="_dragOverlay_1ubmq_42",ut="_Item_1ubmq_50",mt="_withHandle_1ubmq_78",ft="_dragging_1ubmq_83",ht="_disabled_1ubmq_92",pt="_color_1ubmq_110",gt="_Remove_1ubmq_125",xt="_Actions_1ubmq_135",k={Wrapper:ot,fadeIn:ct,dragOverlay:dt,Item:ut,withHandle:mt,dragging:ft,disabled:ht,color:pt,Remove:gt,Actions:xt};ie.memo(ie.forwardRef(({color:e,dragOverlay:a,dragging:r,disabled:l,fadeIn:c,handle:s,handleProps:n,height:f,index:x,listeners:I,onRemove:p,renderItem:v,sorting:j,style:D,transition:b,transform:o,value:g,wrapperStyle:m,...h},w)=>(u.useEffect(()=>{if(a)return document.body.style.cursor="grabbing",()=>{document.body.style.cursor=""}},[a]),v?v({dragOverlay:!!a,dragging:!!r,sorting:!!j,index:x,fadeIn:!!c,listeners:I,ref:w,style:D,transform:o,transition:b,value:g}):t.jsx("li",{className:V(k.Wrapper,c&&k.fadeIn,j&&k.sorting,a&&k.dragOverlay),style:{...m,transition:[b,m==null?void 0:m.transition].filter(Boolean).join(", "),"--translate-x":o?`${Math.round(o.x)}px`:void 0,"--translate-y":o?`${Math.round(o.y)}px`:void 0,"--scale-x":o!=null&&o.scaleX?`${o.scaleX}`:void 0,"--scale-y":o!=null&&o.scaleY?`${o.scaleY}`:void 0,"--index":x,"--color":e},ref:w,children:t.jsxs("div",{className:V(k.Item,r&&k.dragging,s&&k.withHandle,a&&k.dragOverlay,l&&k.disabled,e&&k.color),style:D,"data-cypress":"draggable-item",...s?void 0:I,...h,tabIndex:s?void 0:0,children:[g,t.jsxs("span",{className:k.Actions,children:[p?t.jsx(rt,{className:k.Remove,onClick:p}):null,s?t.jsx(Ie,{...n,...I}):null]})]})}))));const It="_Wrapper_14dj2_1",bt="_clone_14dj2_7",yt="_TreeItem_14dj2_14",jt="_ghost_14dj2_23",Dt="_indicator_14dj2_24",Ct="_Text_14dj2_95",_t="_Count_14dj2_100",Lt="_disableInteraction_14dj2_116",vt="_disableSelection_14dj2_120",Nt="_Collapse_14dj2_129",wt="_collapsed_14dj2_134",R={Wrapper:It,clone:bt,TreeItem:yt,ghost:jt,indicator:Dt,Text:Ct,Count:_t,disableInteraction:Lt,disableSelection:vt,Collapse:Nt,collapsed:wt};function St(...e){return a=>{Tt(a,...e)}}function Tt(e,...a){a.forEach(r=>{typeof r=="function"?r(e):r!=null&&(r.current=e)})}const kt=u.forwardRef(({childCount:e,clone:a,depth:r,disableSelection:l,disableInteraction:c,ghost:s,handleProps:n,indentationWidth:f,indicator:x,collapsed:I,onCollapse:p,onRemove:v,onNavigate:j,style:D,id:b,type:o,newListItem:g,value:m,wrapperRef:h,...w},S)=>{const{t:T}=X("tree-lists");return t.jsx("li",{className:"tree-list-item "+V(R.Wrapper,a&&R.clone,s&&R.ghost,x&&R.indicator,l&&R.disableSelection,c&&R.disableInteraction),ref:St(h,g),style:{"--spacing":`${f*r}px`},...w,children:t.jsxs("div",{className:"tree-item "+R.TreeItem,ref:S,style:D,children:[t.jsxs("div",{className:"tree-item-actions",children:[t.jsx(W,{to:"/?type="+o+"&id="+b,className:"item-nav-link","aria-label":T("go-to-item-id",{id:b}),onClick:j,children:t.jsx("span",{className:"sr-only",children:T("go-to-item-id",{id:b})})}),t.jsx(Ie,{...n}),p&&t.jsx(ne,{onClick:p,className:V(R.Collapse,I&&R.collapsed),children:Rt})]}),t.jsx("span",{className:R.Text,children:m}),a&&e&&e>1?t.jsx("span",{className:R.Count,children:e}):null,!a&&t.jsx("button",{type:"button",className:"delete-item","aria-label":T("delete-list-item"),tabIndex:0,onClick:v})]})})}),Rt=t.jsx("svg",{width:"10",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 70 41",children:t.jsx("path",{d:"M30.76 39.2402C31.885 40.3638 33.41 40.995 35 40.995C36.59 40.995 38.115 40.3638 39.24 39.2402L68.24 10.2402C69.2998 9.10284 69.8768 7.59846 69.8494 6.04406C69.822 4.48965 69.1923 3.00657 68.093 1.90726C66.9937 0.807959 65.5106 0.178263 63.9562 0.150837C62.4018 0.123411 60.8974 0.700397 59.76 1.76024L35 26.5102L10.24 1.76024C9.10259 0.700397 7.59822 0.123411 6.04381 0.150837C4.4894 0.178263 3.00632 0.807959 1.90702 1.90726C0.807714 3.00657 0.178019 4.48965 0.150593 6.04406C0.123167 7.59846 0.700153 9.10284 1.75999 10.2402L30.76 39.2402Z"})}),$t=({isSorting:e,wasDragging:a})=>!(e||a);function me({id:e,type:a,newListItem:r,depth:l,...c}){const{attributes:s,isDragging:n,isSorting:f,listeners:x,setDraggableNodeRef:I,setDroppableNodeRef:p,transform:v,transition:j}=ve({id:e,animateLayoutChanges:$t}),D={transform:se.Translate.toString(v),transition:j};return t.jsx(kt,{id:e,type:a,newListItem:r,ref:I,wrapperRef:p,style:D,depth:l,ghost:n,disableSelection:Ne,disableInteraction:f,handleProps:{...s,...x},...c})}const At=e=>{const a=u.useContext(ge),r=u.useRef(null),{t:l}=X("tree-lists");let c="/?type="+e.type;e.id>0&&(c+="&id="+e.id);const s=n=>{var f,x,I;n.preventDefault(),(f=a.container)!=null&&f.current&&!a.container.current.classList.contains("show")&&(x=a.collapseLink)!=null&&x.current&&a.collapseLink.current.click(),(I=a.listItemInput)!=null&&I.current&&a.listItemInput.current.focus(),r.current&&(r.current.style.cssText="display: none;")};return t.jsx("div",{className:"tree-footer-nav",children:t.jsx(W,{className:"add-item",to:c,onClick:s,ref:r,title:l("add-item"),"aria-label":l("add-item"),children:t.jsx("span",{className:"sr-only",children:l("add-item")})})})},Et={droppable:{strategy:ke.Always}},Ht={keyframes({transform:e}){return[{opacity:1,transform:se.Transform.toString(e.initial)},{opacity:0,transform:se.Transform.toString({...e.final,x:e.final.x+5,y:e.final.y+5})}]},easing:"ease-out",sideEffects({active:e}){e.node.animate([{opacity:0},{opacity:1}],{duration:oe.duration,easing:oe.easing})}};function Ot(e){const a=(e==null?void 0:e.collapsible)||!1,r=(e==null?void 0:e.indicator)||!1,l=(e==null?void 0:e.indentationWidth)||50,[c,s]=u.useState(e.treeItems),[n,f]=u.useState(null),[x,I]=u.useState(null),[p,v]=u.useState(0),[j,D]=u.useState(null),b=he(),o=xe(B(c)),g=o>0?" parent-list":"",m=u.useMemo(()=>{let i=B(c);if(o>0){const y=fe(ae(i,o));i=i.filter(_=>y.includes(+_.id)),i=Qe(i)}const C=i.filter(y=>y.collapsed&&y.hasChildren).map(y=>y.id);return we(i,n!=null?[n,...C]:C)},[n,c,o]),h=n&&x?te(m,n,x,p,l):null,w=u.useRef({items:m,offset:p}),[S]=u.useState(()=>st(w,r,l)),T=Se(le(qe),le(Be,{coordinateGetter:S})),$=u.useMemo(()=>m.map(({id:i})=>i),[m]),E=n?m.find(({id:i})=>i===n):null;u.useEffect(()=>{w.current={items:m,offset:p}},[m,p]);const O={onDragStart({active:i}){return`Picked up ${i.id}.`},onDragMove({active:i,over:d}){return G("onDragMove",i.id,d==null?void 0:d.id)},onDragOver({active:i,over:d}){return G("onDragOver",i.id,d==null?void 0:d.id)},onDragEnd({active:i,over:d}){return G("onDragEnd",i.id,d==null?void 0:d.id)},onDragCancel({active:i}){return`Moving was cancelled. ${i.id} was dropped in its original position.`}};return t.jsxs(Te,{accessibility:{announcements:O},sensors:T,collisionDetection:Re,measuring:Et,onDragStart:q,onDragMove:K,onDragOver:Y,onDragEnd:Z,onDragCancel:z,children:[m.length>0&&t.jsx("ul",{className:"tree-list-tree list-group list-group-flush"+g,children:t.jsxs($e,{items:$,strategy:Ee,children:[m.map(({id:i,text:d,collapsed:C,hasChildren:y,depth:_})=>t.jsx(me,{id:i,type:e.type,newListItem:i===e.latestListItemID?e.newListItem:null,value:d,depth:i===n&&h?h.depth:_,indentationWidth:l,indicator:r,collapsed:!!(C&&y),onCollapse:a&&y?()=>be(i):void 0,onRemove:()=>J(i),onNavigate:e.handleNavigate},i)),Ae.createPortal(t.jsx(He,{dropAnimation:Ht,modifiers:r?[Mt]:void 0,children:n&&E?t.jsx(me,{id:n,type:e.type,newListItem:null,depth:E.depth,clone:!0,childCount:Oe(c,n)+1,value:E.text.toString(),indentationWidth:l}):null}),document.body)]})}),!m.length&&t.jsx(At,{type:e.type,id:o})]});function q({active:{id:i}}){f(i),I(i);const d=m.find(({id:C})=>C===i);d&&D({parentID:d.parentID,overID:i}),document.body.style.setProperty("cursor","grabbing")}function K({delta:i}){v(i.x)}function Y({over:i}){I((i==null?void 0:i.id)??null)}function Z({active:i,over:d}){if(L(),h&&d){let{depth:C,parentID:y}=h;const _=B(c),Q=_.findIndex(({id:U})=>U===d.id),H=_.findIndex(({id:U})=>U===i.id),M=_[H];o>0&&y===null&&(y=o),_[H]={...M,depth:C,parentID:y};const P=re(_,H,Q),F=pe(P);s(F),e.handleDragUpdate(B(F))}}function z(){L()}function L(){I(null),f(null),v(0),D(null),document.body.style.setProperty("cursor","")}function J(i){const y=[...ae(m,i).map(_=>Number(_.id)),Number(i)];b(Me({ids:y,type:e.type}))}function be(i){const d=Pe([...c],i,"collapsed",C=>!C);s(d)}function G(i,d,C){if(C&&h){if(i!=="onDragEnd"){if(j&&h.parentID===j.parentID&&C===j.overID)return;D({parentID:h.parentID,overID:C})}const y=JSON.parse(JSON.stringify(B(c))),_=y.findIndex(({id:N})=>N===C),Q=y.findIndex(({id:N})=>N===d),H=re(y,Q,_),M=H[_-1];let P;const F=i==="onDragEnd"?"dropped":"moved",U=i==="onDragEnd"?"dropped":"nested";if(M)if(h.depth>M.depth)P=`${d} was ${U} under ${M.id}.`;else{let N=M;for(;N&&h.depth<N.depth;){const ye=N.parentID;N=H.find(({id:je})=>je===ye)}N&&(P=`${d} was ${F} after ${N.id}.`)}else{const N=H[_+1];N&&(P=`${d} was ${F} before ${N.id}.`)}return P}}}const Mt=({transform:e})=>({...e,y:e.y-25}),Pt=e=>{const{t:a}=X("tree-lists"),r=B(e.items);let l=[];e.topLevelID>0&&(l=Fe(r,e.topLevelID));const c=l.length>0?" visible":"";return t.jsx("div",{className:"tree-nav"+c,children:l.length>0&&t.jsx("nav",{style:{"--bs-breadcrumb-divider":"'>'"},"aria-label":"breadcrumb",children:t.jsxs("ol",{className:"breadcrumb",children:[l.length>0&&t.jsx("li",{className:"breadcrumb-item home",children:t.jsx(W,{className:"tree-home",to:"/?type="+e.type,onClick:e.clearHistory,children:t.jsx("span",{className:"sr-only",children:a("home")})})},1),l.length>0&&l.reverse().map((s,n)=>e.topLevelID!==s.id?t.jsx("li",{className:"breadcrumb-item",children:t.jsx(W,{to:"/?type="+e.type+"&id="+s.id,onClick:e.clearHistory,children:s.text})},n+2):t.jsx("li",{className:"breadcrumb-item active","aria-current":"page",children:s.text},n+2))]})})})},Ut=()=>{const e=he(),{t:a}=X("tree-lists"),r=u.useContext(Ue),l=r.type,c=We(L=>L.lists),s=Ve(l,c),n=s.length,f=Ke(s),x=pe(s),I=window.matchMedia("(prefers-reduced-motion: reduce)"),p=!I||I.matches?"instant":"smooth",v=u.useRef(p),j=u.useRef(!1),D=u.useRef(!1),b=u.useRef(!1),o=u.useRef(null),g=u.useRef(null),m=u.useRef(null),h=u.useRef(null),w={collapseLink:o,listItemInput:g,container:m},S=xe(s);let T="";if(S>0){const L=Ze(s,S);T=L?L.text:""}let $=Je(s);const{historyState:E,setHistory:O,resetHistory:q}=$;b.current&&(q(s),b.current=!1),u.useEffect(()=>{D.current&&(e(ce({type:l,items:E})),D.current=!1)},[de(E)]),u.useEffect(()=>{E.length!==n&&O(s),j.current&&h.current!==null&&(h.current.scrollIntoView({behavior:v.current}),h.current.classList.add("new-list-item"),setTimeout(function(){h.current!==null&&h.current.classList.remove("new-list-item"),h.current=null},1e3)),j.current=!1},[n]);const K=L=>{if(L.preventDefault(),g.current){let J=null;S>0&&(J=S),e(Xe({type:l,item:{id:0,text:g.current.value,collapsed:!1,parentID:J,depth:0,index:0,hasChildren:!1}})),g.current.value="",j.current=!0}else alert(a("invalid-list-item-try-again"))},Y=L=>{L(),D.current=!0},Z=()=>{b.current=!0},z=L=>{O(L),e(ce({type:l,items:L}))};return t.jsx(ge.Provider,{value:w,children:t.jsxs("div",{className:"tree-lists",children:[t.jsx("div",{className:"list-item-form",children:t.jsxs("form",{className:"app-form",onSubmit:K,children:[t.jsx("h1",{children:r.title}),r.description&&t.jsx("p",{className:"type-desc",children:r.description}),t.jsxs("ul",{className:"nav sub-navigation",children:[t.jsx("li",{className:"nav-item",children:t.jsx(W,{className:"nav-link nav-settings",to:"/settings?type="+l,children:a("settings")})}),t.jsx("li",{children:t.jsx(Ye,{listItemCount:n})})]}),t.jsxs("div",{className:"form-group collapse",id:"form-collapse",ref:m,children:[t.jsxs("div",{className:"form-section",children:[t.jsx("label",{htmlFor:"list-item-text",className:"form-label",children:a("list-item")}),t.jsx("input",{type:"text",id:"list-item-text",className:"form-control",name:"listItemText",ref:g,required:!0})]}),t.jsx("div",{className:"form-section",children:t.jsx("button",{type:"submit",className:"btn btn-success",children:a("add-list-item")})})]})]})}),t.jsxs("div",{className:"list-nav",children:[t.jsx(Pt,{items:x,topLevelID:S,type:l,clearHistory:Z}),t.jsx(ze,{updateHistory:Y,history:$})]}),T&&t.jsx("h5",{className:"top-level-title",children:T}),n>0&&t.jsx(Ot,{treeItems:x,type:l,newListItem:h,latestListItemID:f,handleDragUpdate:z,handleNavigate:Z},de(s)),n===0&&t.jsx("div",{className:"tree-nav",children:t.jsx("p",{children:a("there-are-no-list-items-yet")})})]})})};export{Ut as default};
