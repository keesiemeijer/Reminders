import{e as D,r,j as t,i as H,f as B,h as S,F,k as T,R as P,l as W,m as A,T as q,c as O,n as V,o as $,p as K,q as M,t as Q,L as U,v as z}from"./index-hZHO56zp.js";import{C as G,a as J,H as X}from"./history-nav-BX1WdYsg.js";import{u as j}from"./useTranslation-CiHLiTRY.js";const Y=e=>{const{t:n}=j("common"),u=D(),s=e.settings,[l,o]=r.useState(s.settings.listSort),i=a=>{const c=l==="ASC"?"DESC":"ASC",d={...s.settings,listSort:c},y={...s,settings:d};H(y)&&u(B(y)),o(c)};return t.jsx("button",{type:"button",className:`sort-button sort-button-${l}`,tabIndex:0,"aria-label":n("sort-list"),title:n("sort-list"),onClick:i})},Z=e=>{const{t:n}=j("date-lists"),u=(i,a)=>{if(i.preventDefault(),!(e.dateInput&&e.dateInput.current))return;let c="";if(["plus_day","plus_month"].includes(a.type)){const d=a.type.split("_");c=S(a.value,d[1],e.dateInput.current.value)}else c=S(a.value,a.type);e.dateInput.current.value=c,e.dateInput.current.focus(),e.setDate(c)},s=[{value:0,type:"day",i18n:n("intlRelativeTime-day-auto",{val:0})},{value:1,type:"day",i18n:n("intlRelativeTime-day",{val:1})},{value:2,type:"day",i18n:n("day-WithCount_other",{count:2})}];for(let i=3;i<15;i++)s.push({value:i,type:"day",i18n:i});s.push.apply(s,[{value:1,type:"plus_day",i18n:n("plus-day-WithCount_one",{count:1})},{value:7,type:"plus_day",i18n:n("plus-day-WithCount_other",{count:7})},{value:1,type:"month",i18n:n("intlRelativeTime-month",{val:1})},{value:2,type:"month",i18n:n("month-WithCount_other",{count:2})},{value:3,type:"month",i18n:3},{value:4,type:"month",i18n:4},{value:5,type:"month",i18n:5},{value:6,type:"month",i18n:6},{value:1,type:"plus_month",i18n:n("plus-month-WithCount_one",{count:1})}]);let l=[],o="day";return s.forEach((i,a)=>{const c=i.type;c!==o&&!c.includes("plus")&&(l.push(t.jsx("br",{},"br"+a)),o=c),l.push(t.jsx("button",{type:"button",onClick:d=>u(d,i),className:"btn btn-outline-dark",children:i.i18n},a))}),t.jsx("div",{className:"date-buttons",children:t.jsxs("details",{children:[t.jsxs("summary",{className:"form-label",children:[" ",n("pick-a-date")]}),t.jsx("small",{id:"date-buttons-help",className:"form-text text-muted",children:n("quickly-pick-a-date-with-the-buttons-below")}),l]})})},tt=e=>{const n=F(e.date,e.settings.settings),u=e.settings.settings.pastDateColor,s=e.settings.settings.usePastDateColor,l=e.dateType==="past";let o={};l&&s&&T(u)&&(o={color:u});const i=e.settings.settings.todayDateColor,a=e.settings.settings.useTodayDateColor;return e.dateType==="today"&&a&&T(i)&&(o={color:i}),t.jsx("div",{className:"list-item-date",style:o,children:n})},et=e=>{const n=D(),{t:u}=j("date-lists"),s=r.useRef(null),[l,o]=r.useState(!1),i=e.item.text,a=e.item.id,c=()=>{s.current&&(s.current.textContent=i),o(!0)},d=m=>{var h;(h=m.relatedTarget)!=null&&h.className.includes("edit-item-id-"+a)?g():s.current&&(s.current.textContent=i),o(!1)},y=m=>{m.key==="Enter"&&(m.preventDefault(),g(),s.current&&s.current.blur())},I=m=>{n(A({ids:[e.item.id],type:e.settings.type}))},g=()=>{if(s.current){const m=s.current.textContent;typeof m=="string"&&m.trim()!==""?n(W({type:e.settings.type,id:e.item.id,text:m.trim()})):s.current.textContent=i}};let f="";return e.settings.settings.usePastDateColor&&(f=P(e.item.date)),t.jsxs("li",{className:"list-group-item "+f,ref:e.newListItem,children:[t.jsxs("div",{className:"list-item",children:[t.jsx("div",{ref:s,className:"list-item-text",contentEditable:"plaintext-only",onFocus:c,onBlur:d,onKeyDown:y,suppressContentEditableWarning:!0,role:"textbox",children:i}),t.jsx(tt,{date:e.item.date,settings:e.settings,dateType:f})]}),t.jsx("button",{type:"button",className:`edit-item edit-item-id-${a} ${l?"visible":"hide"}`,tabIndex:0,"aria-label":u("edit-list-item"),title:u("save-list-item"),onClick:g}),t.jsx("button",{type:"button",className:"delete-item",tabIndex:0,"aria-label":u("delete-list-item"),title:u("delete-list-item"),onClick:I})]},e.item.id)},st=e=>{const n=e.listItems.length,u=e.settings.settings.listSort==="DESC"?[...e.listItems].reverse():e.listItems;return t.jsx("ul",{className:"list-group list-group-flush",children:n>0&&u.map(s=>t.jsx(et,{item:s,settings:e.settings,newListItem:s.id===e.latestListItemID?e.newListItem:null},s.id))})},lt=()=>{const e=D(),{t:n}=j("date-lists"),[u,s]=r.useState(""),l=r.useContext(q),o=l.type,i=O(v=>v.lists),a=V(o,i),c=$(a),d=a.length,y=window.matchMedia("(prefers-reduced-motion: reduce)"),I=!y||y.matches?"instant":"smooth",g=r.useRef(I),f=r.useRef(!1),m=r.useRef(!1),h=r.useRef(null),x=r.useRef(null),p=r.useRef(null),N=r.useRef(null),R=r.useRef(null),b=r.useRef(null),w={collapseLink:R,listItemInput:h,container:N},L=K(a),{historyState:C,setHistory:k}=L;r.useEffect(()=>{m.current&&(e(M({type:o,items:C})),m.current=!1)},[C.length]),r.useEffect(()=>{C.length!==d&&k(a),f.current&&p.current!==null&&(p.current.scrollIntoView({behavior:g.current}),p.current.classList.add("new-list-item"),setTimeout(function(){p.current!==null&&p.current.classList.remove("new-list-item"),p.current=null},1e3)),f.current=!1},[d]);const E=v=>{v.preventDefault(),h.current&&x.current?(e(z({type:o,item:{id:0,text:h.current.value,date:x.current.value}})),h.current.value="",x.current.value="",f.current=!0):alert(n("invalid-list-item-try-again"))},_=v=>{v(),m.current=!0};return r.useEffect(()=>{!x.current||!b.current||(b.current.innerHTML=Q(x.current.value))},[u]),t.jsx(G.Provider,{value:w,children:t.jsxs("div",{className:"date-lists",children:[t.jsx("div",{className:"list-item-form",children:t.jsxs("form",{className:"app-form",onSubmit:E,children:[t.jsx("h1",{children:l.title}),l.description&&t.jsx("p",{className:"type-desc",children:l.description}),t.jsxs("ul",{className:"nav sub-navigation",children:[t.jsx("li",{className:"nav-item",children:t.jsx(U,{className:"nav-link nav-settings",to:"/settings?type="+o,children:n("settings")})}),t.jsx("li",{children:t.jsx(J,{listItemCount:d})})]}),t.jsxs("div",{className:"form-group collapse",id:"form-collapse",ref:N,children:[t.jsxs("div",{className:"form-section",children:[t.jsx("label",{htmlFor:"list-item-text",className:"form-label",children:n("list-item")}),t.jsx("input",{type:"text",id:"list-item-text",className:"form-control",name:"listItemText",ref:h,required:!0})]}),t.jsxs("div",{className:"form-section",children:[t.jsx("label",{htmlFor:"list-item-date",className:"form-label",children:n("list-item-date")}),t.jsxs("div",{className:"date-container",children:[t.jsx("input",{type:"date",id:"list-item-date",className:"form-control",name:"listItemDate",ref:x,onChange:v=>s(v.target.value),required:!0}),t.jsx("p",{className:"date-preview",ref:b})]})]}),t.jsx("div",{className:"form-section",children:t.jsx(Z,{dateInput:x,setDate:s})}),t.jsx("div",{className:"form-section",children:t.jsx("button",{type:"submit",className:"btn btn-success",children:n("add-list-item")})})]})]})}),t.jsxs("div",{className:"list-nav date-list-nav",children:[t.jsx(X,{updateHistory:_,history:L}),d>1&&t.jsx(Y,{settings:l})]}),t.jsx(st,{listType:o,settings:l,listItems:a,newListItem:p,latestListItemID:c}),d===0&&t.jsx("p",{children:n("there-are-no-list-items-yet")})]})})};export{lt as default};
