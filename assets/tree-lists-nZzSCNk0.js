import{b as De,w as pe,K as A,x as se,y as ve,z as Le,A as _e,r as u,j as t,B as oe,e as ie,L as z,l as Ne,C as we,D as ne,E as Se,G as J,H as re,I as Te,J as ke,M as le,N as Ee,O as Re,P as $e,S as Me,Q as Ae,U as He,V as Oe,W as Be,X as ce,Y as xe,m as Pe,Z as qe,$ as Fe,a0 as We,a1 as de,a2 as Ke,T as Ue,c as Ve,n as Ze,o as Je,a3 as Xe,p as Ye,a4 as ue,a5 as me,a6 as ze}from"./index-dKj0z-t1.js";import{E as ge}from"./lists-DIXC-Y0f.js";import{C as Ie,E as Ge,a as Qe,H as et}from"./history-nav-Cxhs9TFM.js";import{u as Q}from"./useTranslation-Q3H9OjDf.js";const be=e=>{const[i]=De();if(!i.has("id"))return 0;const o=i.get("id");let r=typeof o=="string"?+o:0;const c=pe(e);return r&&!isNaN(r)&&c.includes(r)?r:0},tt=e=>{const i=e.map(o=>o.depth);return Math.min(...i)},st=e=>{const i=tt(e);return e.map(r=>(r.depth=r.depth-i,r))},nt=[A.Down,A.Right,A.Up,A.Left],it=[A.Left,A.Right],at=(e,i,o)=>(r,{currentCoordinates:c,context:{active:a,over:s,collisionRect:m,droppableRects:g,droppableContainers:x}})=>{if(nt.includes(r.code)){if(!a||!m)return;r.preventDefault();const{current:{items:h,offset:T}}=e;if(it.includes(r.code)&&(s!=null&&s.id)){const{depth:l,maxDepth:j,minDepth:d}=se(h,a.id,s.id,T,o);switch(r.code){case A.Left:if(l>d)return{...c,x:c.x-o};break;case A.Right:if(l<j)return{...c,x:c.x+o};break}return}const L=[];x.forEach(l=>{if(l!=null&&l.disabled||l.id===(s==null?void 0:s.id))return;const j=g.get(l.id);if(j)switch(r.code){case A.Down:m.top<j.top&&L.push(l);break;case A.Up:m.top>j.top&&L.push(l);break}});const y=ve({collisionRect:m,droppableRects:g,droppableContainers:L});let p=Le(y,"id");if(p===(s==null?void 0:s.id)&&y.length>1&&(p=y[1].id),p&&(s!=null&&s.id)){const l=g.get(a.id),j=g.get(p),d=x.get(p);if(l&&j&&d){const I=h.findIndex(({id:v})=>v===p),C=h[I],H=h.findIndex(({id:v})=>v===a.id),E=h[H];if(C&&E){const{depth:v}=se(h,a.id,p,(C.depth-E.depth)*o,o),D=I>H?1:-1,O=i?(m.height-l.height)/2:0;return{x:j.left+v*o,y:j.top+D*O}}}}}};var te={exports:{}};/*!
	Copyright (c) 2018 Jed Watson.
	Licensed under the MIT License (MIT), see
	http://jedwatson.github.io/classnames
*/var fe;function ot(){return fe||(fe=1,function(e){(function(){var i={}.hasOwnProperty;function o(){for(var a="",s=0;s<arguments.length;s++){var m=arguments[s];m&&(a=c(a,r(m)))}return a}function r(a){if(typeof a=="string"||typeof a=="number")return a;if(typeof a!="object")return"";if(Array.isArray(a))return o.apply(null,a);if(a.toString!==Object.prototype.toString&&!a.toString.toString().includes("[native code]"))return a.toString();var s="";for(var m in a)i.call(a,m)&&a[m]&&(s=c(s,m));return s}function c(a,s){return s?a?a+" "+s:a+s:a}e.exports?(o.default=o,e.exports=o):window.classNames=o})()}(te)),te.exports}var rt=ot();const G=_e(rt),lt="_Action_4wa11_1",ct={Action:lt},ae=u.forwardRef(({active:e,className:i,cursor:o,style:r,...c},a)=>t.jsx("button",{ref:a,...c,className:"btn-handle "+G(ct.Action,i),tabIndex:0,style:{...r,cursor:o,"--fill":e==null?void 0:e.fill,"--background":e==null?void 0:e.background}})),ye=u.forwardRef((e,i)=>t.jsx(ae,{ref:i,cursor:"grab","data-cypress":"draggable-handle",...e}));function dt(e){return t.jsx(ae,{...e,active:{fill:"rgba(255, 70, 70, 0.95)",background:"rgba(255, 70, 70, 0.1)"},children:t.jsx("svg",{width:"8",viewBox:"0 0 22 22",xmlns:"http://www.w3.org/2000/svg",children:t.jsx("path",{d:"M2.99998 -0.000206962C2.7441 -0.000206962 2.48794 0.0972617 2.29294 0.292762L0.292945 2.29276C-0.0980552 2.68376 -0.0980552 3.31682 0.292945 3.70682L7.58591 10.9998L0.292945 18.2928C-0.0980552 18.6838 -0.0980552 19.3168 0.292945 19.7068L2.29294 21.7068C2.68394 22.0978 3.31701 22.0978 3.70701 21.7068L11 14.4139L18.2929 21.7068C18.6829 22.0978 19.317 22.0978 19.707 21.7068L21.707 19.7068C22.098 19.3158 22.098 18.6828 21.707 18.2928L14.414 10.9998L21.707 3.70682C22.098 3.31682 22.098 2.68276 21.707 2.29276L19.707 0.292762C19.316 -0.0982383 18.6829 -0.0982383 18.2929 0.292762L11 7.58573L3.70701 0.292762C3.51151 0.0972617 3.25585 -0.000206962 2.99998 -0.000206962Z"})})})}const ut="_Wrapper_1ubmq_31",mt="_fadeIn_1ubmq_38",ft="_dragOverlay_1ubmq_42",ht="_Item_1ubmq_50",pt="_withHandle_1ubmq_78",xt="_dragging_1ubmq_83",gt="_disabled_1ubmq_92",It="_color_1ubmq_110",bt="_Remove_1ubmq_125",yt="_Actions_1ubmq_135",$={Wrapper:ut,fadeIn:mt,dragOverlay:ft,Item:ht,withHandle:pt,dragging:xt,disabled:gt,color:It,Remove:bt,Actions:yt};oe.memo(oe.forwardRef(({color:e,dragOverlay:i,dragging:o,disabled:r,fadeIn:c,handle:a,handleProps:s,height:m,index:g,listeners:x,onRemove:h,renderItem:T,sorting:L,style:y,transition:p,transform:l,value:j,wrapperStyle:d,...I},C)=>(u.useEffect(()=>{if(i)return document.body.style.cursor="grabbing",()=>{document.body.style.cursor=""}},[i]),T?T({dragOverlay:!!i,dragging:!!o,sorting:!!L,index:g,fadeIn:!!c,listeners:x,ref:C,style:y,transform:l,transition:p,value:j}):t.jsx("li",{className:G($.Wrapper,c&&$.fadeIn,L&&$.sorting,i&&$.dragOverlay),style:{...d,transition:[p,d==null?void 0:d.transition].filter(Boolean).join(", "),"--translate-x":l?`${Math.round(l.x)}px`:void 0,"--translate-y":l?`${Math.round(l.y)}px`:void 0,"--scale-x":l!=null&&l.scaleX?`${l.scaleX}`:void 0,"--scale-y":l!=null&&l.scaleY?`${l.scaleY}`:void 0,"--index":g,"--color":e},ref:C,children:t.jsxs("div",{className:G($.Item,o&&$.dragging,a&&$.withHandle,i&&$.dragOverlay,r&&$.disabled,e&&$.color),style:y,"data-cypress":"draggable-item",...a?void 0:x,...I,tabIndex:a?void 0:0,children:[j,t.jsxs("span",{className:$.Actions,children:[h?t.jsx(dt,{className:$.Remove,onClick:h}):null,a?t.jsx(ye,{...s,...x}):null]})]})}))));const jt="_Wrapper_14dj2_1",Ct="_clone_14dj2_7",Dt="_TreeItem_14dj2_14",vt="_ghost_14dj2_23",Lt="_indicator_14dj2_24",_t="_Text_14dj2_95",Nt="_Count_14dj2_100",wt="_disableInteraction_14dj2_116",St="_disableSelection_14dj2_120",Tt="_Collapse_14dj2_129",kt="_collapsed_14dj2_134",M={Wrapper:jt,clone:Ct,TreeItem:Dt,ghost:vt,indicator:Lt,Text:_t,Count:Nt,disableInteraction:wt,disableSelection:St,Collapse:Tt,collapsed:kt};function Et(...e){return i=>{Rt(i,...e)}}function Rt(e,...i){i.forEach(o=>{typeof o=="function"?o(e):o!=null&&(o.current=e)})}const $t=u.forwardRef(({childCount:e,clone:i,depth:o,disableSelection:r,disableInteraction:c,ghost:a,handleProps:s,indentationWidth:m,indicator:g,collapsed:x,onCollapse:h,onRemove:T,onNavigate:L,style:y,id:p,type:l,newListItem:j,value:d,wrapperRef:I,...C},H)=>{const E=ie(),{editMode:v}=u.useContext(ge),{t:S}=Q(["common"]),D=u.useRef(null),[O,P]=u.useState(!1),q=d,W=p,K=()=>{D.current&&(D.current.textContent=q),P(!0)},U=R=>{var n;(n=R.relatedTarget)!=null&&n.className.includes("edit-item-id-"+W)?B():D.current&&(D.current.textContent=q),P(!1)},N=R=>{R.key==="Enter"&&(R.preventDefault(),B(),D.current&&D.current.blur())},B=()=>{if(D.current){const R=D.current.textContent;typeof R=="string"&&R.trim()!==""?E(Ne({type:l,id:p,text:R.trim()})):D.current.textContent=q}};return t.jsx("li",{className:"tree-list-item "+G(M.Wrapper,i&&M.clone,a&&M.ghost,g&&M.indicator,r&&M.disableSelection,c&&M.disableInteraction),ref:Et(I,j),style:{"--spacing":`${m*o}px`},...C,children:t.jsxs("div",{className:"tree-item "+M.TreeItem,ref:H,style:y,children:[v&&t.jsxs("div",{className:"tree-item-actions",children:[t.jsx(z,{to:"/?type="+l+"&id="+p,className:"item-nav-link","aria-label":S("go-to-item-id",{id:p}),onClick:L,children:t.jsx("span",{className:"sr-only",children:S("go-to-item-id",{id:p})})}),t.jsx(ye,{...s}),h&&t.jsx(ae,{onClick:h,className:G(M.Collapse,x&&M.collapsed),children:Mt})]}),v&&t.jsx("div",{className:M.Text+" edit-mode",ref:D,contentEditable:"plaintext-only",onFocus:K,onBlur:U,onKeyDown:N,suppressContentEditableWarning:!0,role:"textbox",children:d}),!v&&t.jsx("div",{className:M.Text+" view-mode",children:d}),i&&e&&e>1?t.jsx("span",{className:M.Count,children:e}):null,!i&&v&&t.jsx("button",{type:"button",className:`edit-item edit-item-id-${W} ${O?"visible":"hide"}`,tabIndex:0,"aria-label":S("edit-list-item"),title:S("save-list-item"),onClick:B}),!i&&v&&t.jsx("button",{type:"button",className:"delete-item",tabIndex:0,onClick:T,"aria-label":S("delete-list-item"),title:S("delete-list-item")})]})})}),Mt=t.jsx("svg",{width:"10",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 70 41",children:t.jsx("path",{d:"M30.76 39.2402C31.885 40.3638 33.41 40.995 35 40.995C36.59 40.995 38.115 40.3638 39.24 39.2402L68.24 10.2402C69.2998 9.10284 69.8768 7.59846 69.8494 6.04406C69.822 4.48965 69.1923 3.00657 68.093 1.90726C66.9937 0.807959 65.5106 0.178263 63.9562 0.150837C62.4018 0.123411 60.8974 0.700397 59.76 1.76024L35 26.5102L10.24 1.76024C9.10259 0.700397 7.59822 0.123411 6.04381 0.150837C4.4894 0.178263 3.00632 0.807959 1.90702 1.90726C0.807714 3.00657 0.178019 4.48965 0.150593 6.04406C0.123167 7.59846 0.700153 9.10284 1.75999 10.2402L30.76 39.2402Z"})}),At=({isSorting:e,wasDragging:i})=>!(e||i);function he({id:e,type:i,newListItem:o,depth:r,...c}){const{attributes:a,isDragging:s,isSorting:m,listeners:g,setDraggableNodeRef:x,setDroppableNodeRef:h,transform:T,transition:L}=we({id:e,animateLayoutChanges:At}),y={transform:ne.Translate.toString(T),transition:L};return t.jsx($t,{id:e,type:i,newListItem:o,ref:x,wrapperRef:h,style:y,depth:r,ghost:s,disableSelection:Se,disableInteraction:m,handleProps:{...a,...g},...c})}const Ht=e=>{const i=u.useContext(Ie),o=u.useRef(null),{t:r}=Q("common");let c="/?type="+e.type;e.id>0&&(c+="&id="+e.id);const a=s=>{var m,g,x;s.preventDefault(),(m=i.container)!=null&&m.current&&!i.container.current.classList.contains("show")&&(g=i.collapseLink)!=null&&g.current&&i.collapseLink.current.click(),(x=i.listItemInput)!=null&&x.current&&i.listItemInput.current.focus(),o.current&&(o.current.style.cssText="display: none;")};return t.jsx("div",{className:"tree-footer-nav",children:t.jsx(z,{className:"add-item",to:c,onClick:a,ref:o,title:r("add-item"),"aria-label":r("add-item"),children:t.jsx("span",{className:"sr-only",children:r("add-item")})})})},Ot={droppable:{strategy:Re.Always}},Bt={keyframes({transform:e}){return[{opacity:1,transform:ne.Transform.toString(e.initial)},{opacity:0,transform:ne.Transform.toString({...e.final,x:e.final.x+5,y:e.final.y+5})}]},easing:"ease-out",sideEffects({active:e}){e.node.animate([{opacity:0},{opacity:1}],{duration:de.duration,easing:de.easing})}};function Pt(e){const i=(e==null?void 0:e.collapsible)||!1,o=(e==null?void 0:e.indicator)||!1,r=(e==null?void 0:e.indentationWidth)||50,[c,a]=u.useState(e.treeItems),[s,m]=u.useState(null),[g,x]=u.useState(null),[h,T]=u.useState(0),[L,y]=u.useState(null),p=ie(),l=be(J(c)),j=l>0?" parent-list":"",d=u.useMemo(()=>{let n=J(c);if(l>0){const b=pe(re(n,l));n=n.filter(w=>b.includes(+w.id)),n=st(n)}const _=n.filter(b=>b.collapsed&&b.hasChildren).map(b=>b.id);return Te(n,s!=null?[s,..._]:_)},[s,c,l]),I=s&&g?se(d,s,g,h,r):null,C=u.useRef({items:d,offset:h}),[H]=u.useState(()=>at(C,o,r)),E=ke(le(We),le(Fe,{coordinateGetter:H})),v=u.useMemo(()=>d.map(({id:n})=>n),[d]),S=s?d.find(({id:n})=>n===s):null;u.useEffect(()=>{C.current={items:d,offset:h}},[d,h]);const D={onDragStart({active:n}){return`Picked up ${n.id}.`},onDragMove({active:n,over:f}){return R("onDragMove",n.id,f==null?void 0:f.id)},onDragOver({active:n,over:f}){return R("onDragOver",n.id,f==null?void 0:f.id)},onDragEnd({active:n,over:f}){return R("onDragEnd",n.id,f==null?void 0:f.id)},onDragCancel({active:n}){return`Moving was cancelled. ${n.id} was dropped in its original position.`}};return t.jsxs(Ee,{accessibility:{announcements:D},sensors:E,collisionDetection:$e,measuring:Ot,onDragStart:O,onDragMove:P,onDragOver:q,onDragEnd:W,onDragCancel:K,children:[d.length>0&&t.jsx("ul",{className:"tree-list-tree list-group list-group-flush"+j,children:t.jsxs(Me,{items:v,strategy:He,children:[d.map(({id:n,text:f,collapsed:_,hasChildren:b,depth:w})=>t.jsx(he,{id:n,type:e.type,newListItem:n===e.latestListItemID?e.newListItem:null,value:f,depth:n===s&&I?I.depth:w,indentationWidth:r,indicator:o,collapsed:!!(_&&b),onCollapse:i&&b?()=>B(n):void 0,onRemove:()=>N(n),onNavigate:e.handleNavigate},n)),Ae.createPortal(t.jsx(Oe,{dropAnimation:Bt,modifiers:o?[qt]:void 0,children:s&&S?t.jsx(he,{id:s,type:e.type,newListItem:null,depth:S.depth,clone:!0,childCount:Be(c,s)+1,value:S.text.toString(),indentationWidth:r}):null}),document.body)]})}),!d.length&&t.jsx(Ht,{type:e.type,id:l})]});function O({active:{id:n}}){m(n),x(n);const f=d.find(({id:_})=>_===n);f&&y({parentID:f.parentID,overID:n}),document.body.style.setProperty("cursor","grabbing")}function P({delta:n}){T(n.x)}function q({over:n}){x((n==null?void 0:n.id)??null)}function W({active:n,over:f}){if(U(),I&&f){let{depth:_,parentID:b}=I;const w=J(c),ee=w.findIndex(({id:Y})=>Y===f.id),F=w.findIndex(({id:Y})=>Y===n.id),V=w[F];l>0&&b===null&&(b=l),w[F]={...V,depth:_,parentID:b};const Z=ce(w,F,ee),X=xe(Z);a(X),e.handleDragUpdate(J(X))}}function K(){U()}function U(){x(null),m(null),T(0),y(null),document.body.style.setProperty("cursor","")}function N(n){const b=[...re(d,n).map(w=>Number(w.id)),Number(n)];p(Pe({ids:b,type:e.type}))}function B(n){const f=qe([...c],n,"collapsed",_=>!_);a(f)}function R(n,f,_){if(_&&I){if(n!=="onDragEnd"){if(L&&I.parentID===L.parentID&&_===L.overID)return;y({parentID:I.parentID,overID:_})}const b=JSON.parse(JSON.stringify(J(c))),w=b.findIndex(({id:k})=>k===_),ee=b.findIndex(({id:k})=>k===f),F=ce(b,ee,w),V=F[w-1];let Z;const X=n==="onDragEnd"?"dropped":"moved",Y=n==="onDragEnd"?"dropped":"nested";if(V)if(I.depth>V.depth)Z=`${f} was ${Y} under ${V.id}.`;else{let k=V;for(;k&&I.depth<k.depth;){const je=k.parentID;k=F.find(({id:Ce})=>Ce===je)}k&&(Z=`${f} was ${X} after ${k.id}.`)}else{const k=F[w+1];k&&(Z=`${f} was ${X} before ${k.id}.`)}return Z}}}const qt=({transform:e})=>({...e,y:e.y-25}),Ft=e=>{const{t:i}=Q("common"),o=J(e.items);let r=[];e.topLevelID>0&&(r=Ke(o,e.topLevelID));const c=r.length>0?" visible":"";return t.jsx("div",{className:"tree-nav"+c,children:r.length>0&&t.jsx("nav",{style:{"--bs-breadcrumb-divider":"'>'"},"aria-label":"breadcrumb",children:t.jsxs("ol",{className:"breadcrumb",children:[r.length>0&&t.jsx("li",{className:"breadcrumb-item home",children:t.jsx(z,{className:"tree-home",to:"/?type="+e.type,onClick:e.clearHistory,children:t.jsx("span",{className:"sr-only",children:i("home")})})},1),r.length>0&&r.reverse().map((a,s)=>e.topLevelID!==a.id?t.jsx("li",{className:"breadcrumb-item",children:t.jsx(z,{to:"/?type="+e.type+"&id="+a.id,onClick:e.clearHistory,children:a.text})},s+2):t.jsx("li",{className:"breadcrumb-item active","aria-current":"page",children:a.text},s+2))]})})})},Zt=()=>{const e=ie(),{t:i}=Q("common"),{editMode:o}=u.useContext(ge),r=u.useContext(Ue),c=r.type,a=Ve(N=>N.lists),s=Ze(c,a),m=s.length,g=Je(s),x=xe(s),h=window.matchMedia("(prefers-reduced-motion: reduce)"),T=!h||h.matches?"instant":"smooth",L=u.useRef(T),y=u.useRef(!1),p=u.useRef(!1),l=u.useRef(!1),j=u.useRef(null),d=u.useRef(null),I=u.useRef(null),C=u.useRef(null),H={collapseLink:j,listItemInput:d,container:I},E=be(s);let v="";if(E>0){const N=Xe(s,E);v=N?N.text:""}let S=Ye(s);const{historyState:D,setHistory:O,resetHistory:P}=S;l.current&&(P(s),l.current=!1),u.useEffect(()=>{p.current&&(e(ue({type:c,items:D})),p.current=!1)},[me(D)]),u.useEffect(()=>{D.length!==m&&O(s),y.current&&C.current!==null&&(C.current.scrollIntoView({behavior:L.current}),C.current.classList.add("new-list-item"),setTimeout(function(){C.current!==null&&C.current.classList.remove("new-list-item"),C.current=null},1e3)),y.current=!1},[m]);const q=N=>{if(N.preventDefault(),d.current){let B=null;E>0&&(B=E),e(ze({type:c,item:{id:0,text:d.current.value,collapsed:!1,parentID:B,depth:0,index:0,hasChildren:!1}})),d.current.value="",y.current=!0}else alert(i("invalid-list-item-try-again"))},W=N=>{N(),p.current=!0},K=()=>{l.current=!0},U=N=>{O(N),e(ue({type:c,items:N}))};return t.jsx(Ie.Provider,{value:H,children:t.jsxs("div",{className:"tree-lists",children:[t.jsx("div",{className:"list-item-form",children:t.jsxs("form",{className:"app-form",onSubmit:q,children:[t.jsx("h1",{children:r.title}),r.description&&t.jsx("p",{className:"type-desc",children:r.description}),t.jsxs("ul",{className:"nav sub-navigation",children:[t.jsx("li",{children:t.jsx(Ge,{})}),o&&t.jsxs(t.Fragment,{children:[t.jsx("li",{className:"nav-item",children:t.jsx(z,{className:"nav-link nav-settings",to:"/settings?type="+c,children:i("settings")})}),t.jsx("li",{children:t.jsx(Qe,{listItemCount:m})})]})]}),o&&t.jsxs("div",{className:"form-group collapse",id:"form-collapse",ref:I,children:[t.jsxs("div",{className:"form-section",children:[t.jsx("label",{htmlFor:"list-item-text",className:"form-label",children:i("list-item")}),t.jsx("input",{type:"text",id:"list-item-text",className:"form-control",name:"listItemText",ref:d,required:!0})]}),t.jsx("div",{className:"form-section",children:t.jsx("button",{type:"submit",className:"btn btn-success",children:i("add-list-item")})})]})]})}),t.jsx("div",{className:"list-nav",children:o&&t.jsxs(t.Fragment,{children:[t.jsx(Ft,{items:x,topLevelID:E,type:c,clearHistory:K}),t.jsx(et,{updateHistory:W,history:S})]})}),v&&t.jsx("h5",{className:"top-level-title",children:v}),m>0&&t.jsx(Pt,{treeItems:x,type:c,newListItem:C,latestListItemID:g,handleDragUpdate:U,handleNavigate:K},me(s)),m===0&&t.jsx("div",{className:"tree-nav",children:t.jsx("p",{children:i("there-are-no-list-items-yet")})})]})})};export{Zt as default};
