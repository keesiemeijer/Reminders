import{e as D,r,j as t,f as H,h as S,F as B,i as T,R as F,k as P,l as W,T as A,c as q,m as $,n as K,o as M,p as O,q as V,L as Q,t as U}from"./index-B8V-HFyL.js";import{C as z,a as G,H as J}from"./history-nav-BzMkxz_i.js";import{u as j}from"./useTranslation-BV05s8M1.js";const X=e=>{const{t:n}=j("common"),u=D(),s=e.settings,[l,o]=r.useState(s.settings.listSort),i=a=>{const c=l==="ASC"?"DESC":"ASC",d={...s.settings,listSort:c},v={...s,settings:d};u(H(v)),o(c)};return t.jsx("button",{type:"button",className:`sort-button sort-button-${l}`,tabIndex:0,"aria-label":n("sort-list"),title:n("sort-list"),onClick:i})},Y=e=>{const{t:n}=j("date-lists"),u=(i,a)=>{if(i.preventDefault(),!(e.dateInput&&e.dateInput.current))return;let c="";if(["plus_day","plus_month"].includes(a.type)){const d=a.type.split("_");c=S(a.value,d[1],e.dateInput.current.value)}else c=S(a.value,a.type);e.dateInput.current.value=c,e.dateInput.current.focus(),e.setDate(c)},s=[{value:0,type:"day",i18n:n("intlRelativeTime-day-auto",{val:0})},{value:1,type:"day",i18n:n("intlRelativeTime-day",{val:1})},{value:2,type:"day",i18n:n("day-WithCount_other",{count:2})}];for(let i=3;i<15;i++)s.push({value:i,type:"day",i18n:i});s.push.apply(s,[{value:1,type:"plus_day",i18n:n("plus-day-WithCount_one",{count:1})},{value:7,type:"plus_day",i18n:n("plus-day-WithCount_other",{count:7})},{value:1,type:"month",i18n:n("intlRelativeTime-month",{val:1})},{value:2,type:"month",i18n:n("month-WithCount_other",{count:2})},{value:3,type:"month",i18n:3},{value:4,type:"month",i18n:4},{value:5,type:"month",i18n:5},{value:6,type:"month",i18n:6},{value:1,type:"plus_month",i18n:n("plus-month-WithCount_one",{count:1})}]);let l=[],o="day";return s.forEach((i,a)=>{const c=i.type;c!==o&&!c.includes("plus")&&(l.push(t.jsx("br",{},"br"+a)),o=c),l.push(t.jsx("button",{type:"button",onClick:d=>u(d,i),className:"btn btn-outline-dark",children:i.i18n},a))}),t.jsx("div",{className:"date-buttons",children:t.jsxs("details",{children:[t.jsxs("summary",{className:"form-label",children:[" ",n("pick-a-date")]}),t.jsx("small",{id:"date-buttons-help",className:"form-text text-muted",children:n("quickly-pick-a-date-with-the-buttons-below")}),l]})})},Z=e=>{const n=B(e.date,e.settings.settings),u=e.settings.settings.pastDateColor,s=e.settings.settings.usePastDateColor,l=e.dateType==="past";let o={};l&&s&&T(u)&&(o={color:u});const i=e.settings.settings.todayDateColor,a=e.settings.settings.useTodayDateColor;return e.dateType==="today"&&a&&T(i)&&(o={color:i}),t.jsx("div",{className:"list-item-date",style:o,children:n})},tt=e=>{const n=D(),{t:u}=j("date-lists"),s=r.useRef(null),[l,o]=r.useState(!1),i=e.item.text,a=e.item.id,c=()=>{s.current&&(s.current.textContent=i),o(!0)},d=m=>{var h;(h=m.relatedTarget)!=null&&h.className.includes("edit-item-id-"+a)?g():s.current&&(s.current.textContent=i),o(!1)},v=m=>{m.key==="Enter"&&(m.preventDefault(),g(),s.current&&s.current.blur())},I=m=>{n(W({ids:[e.item.id],type:e.settings.type}))},g=()=>{if(s.current){const m=s.current.textContent;typeof m=="string"&&m.trim()!==""?n(P({type:e.settings.type,id:e.item.id,text:m.trim()})):s.current.textContent=i}};let y="";return e.settings.settings.usePastDateColor&&(y=F(e.item.date)),t.jsxs("li",{className:"list-group-item "+y,ref:e.newListItem,children:[t.jsxs("div",{className:"list-item",children:[t.jsx("div",{ref:s,className:"list-item-text",contentEditable:"plaintext-only",onFocus:c,onBlur:d,onKeyDown:v,suppressContentEditableWarning:!0,role:"textbox",children:i}),t.jsx(Z,{date:e.item.date,settings:e.settings,dateType:y})]}),t.jsx("button",{type:"button",className:`edit-item edit-item-id-${a} ${l?"visible":"hide"}`,tabIndex:0,"aria-label":u("edit-list-item"),title:u("save-list-item"),onClick:g}),t.jsx("button",{type:"button",className:"delete-item",tabIndex:0,"aria-label":u("delete-list-item"),title:u("delete-list-item"),onClick:I})]},e.item.id)},et=e=>{const n=e.listItems.length,u=e.settings.settings.listSort==="DESC"?[...e.listItems].reverse():e.listItems;return t.jsx("ul",{className:"list-group list-group-flush",children:n>0&&u.map(s=>t.jsx(tt,{item:s,settings:e.settings,newListItem:s.id===e.latestListItemID?e.newListItem:null},s.id))})},at=()=>{const e=D(),{t:n}=j("date-lists"),[u,s]=r.useState(""),l=r.useContext(A),o=l.type,i=q(p=>p.lists),a=$(o,i),c=K(a),d=a.length,v=window.matchMedia("(prefers-reduced-motion: reduce)"),I=!v||v.matches?"instant":"smooth",g=r.useRef(I),y=r.useRef(!1),m=r.useRef(!1),h=r.useRef(null),f=r.useRef(null),x=r.useRef(null),N=r.useRef(null),R=r.useRef(null),b=r.useRef(null),w={collapseLink:R,listItemInput:h,container:N},L=M(a),{historyState:C,setHistory:k}=L;r.useEffect(()=>{m.current&&(e(O({type:o,items:C})),m.current=!1)},[C.length]),r.useEffect(()=>{C.length!==d&&k(a),y.current&&x.current!==null&&(x.current.scrollIntoView({behavior:g.current}),x.current.classList.add("new-list-item"),setTimeout(function(){x.current!==null&&x.current.classList.remove("new-list-item"),x.current=null},1e3)),y.current=!1},[d]);const E=p=>{p.preventDefault(),h.current&&f.current?(e(U({type:o,item:{id:0,text:h.current.value,date:f.current.value}})),h.current.value="",f.current.value="",y.current=!0):alert(n("invalid-list-item-try-again"))},_=p=>{p(),m.current=!0};return r.useEffect(()=>{!f.current||!b.current||(b.current.innerHTML=V(f.current.value))},[u]),t.jsx(z.Provider,{value:w,children:t.jsxs("div",{className:"date-lists",children:[t.jsx("div",{className:"list-item-form",children:t.jsxs("form",{className:"app-form",onSubmit:E,children:[t.jsx("h1",{children:l.title}),l.description&&t.jsx("p",{className:"type-desc",children:l.description}),t.jsxs("ul",{className:"nav sub-navigation",children:[t.jsx("li",{className:"nav-item",children:t.jsx(Q,{className:"nav-link nav-settings",to:"/settings?type="+o,children:n("settings")})}),t.jsx("li",{children:t.jsx(G,{listItemCount:d})})]}),t.jsxs("div",{className:"form-group collapse",id:"form-collapse",ref:N,children:[t.jsxs("div",{className:"form-section",children:[t.jsx("label",{htmlFor:"list-item-text",className:"form-label",children:n("list-item")}),t.jsx("input",{type:"text",id:"list-item-text",className:"form-control",name:"listItemText",ref:h,required:!0})]}),t.jsxs("div",{className:"form-section",children:[t.jsx("label",{htmlFor:"list-item-date",className:"form-label",children:n("list-item-date")}),t.jsxs("div",{className:"date-container",children:[t.jsx("input",{type:"date",id:"list-item-date",className:"form-control",name:"listItemDate",ref:f,onChange:p=>s(p.target.value),required:!0}),t.jsx("p",{className:"date-preview",ref:b})]})]}),t.jsx("div",{className:"form-section",children:t.jsx(Y,{dateInput:f,setDate:s})}),t.jsx("div",{className:"form-section",children:t.jsx("button",{type:"submit",className:"btn btn-success",children:n("add-list-item")})})]})]})}),t.jsxs("div",{className:"list-nav date-list-nav",children:[t.jsx(J,{updateHistory:_,history:L}),d>1&&t.jsx(X,{settings:l})]}),t.jsx(et,{listType:o,settings:l,listItems:a,newListItem:x,latestListItemID:c}),d===0&&t.jsx("p",{children:n("there-are-no-list-items-yet")})]})})};export{at as default};
