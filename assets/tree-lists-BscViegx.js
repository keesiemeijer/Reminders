import{b as De,w as pe,K as A,x as se,y as ve,z as Le,A as Ne,r as m,j as t,B as oe,e as ie,L as G,l as _e,C as we,D as ne,E as Se,G as Z,H as re,I as Te,J as ke,M as le,N as Ee,O as Re,P as $e,S as Me,Q as Ae,U as He,V as Fe,W as Oe,X as ce,Y as xe,m as Be,Z as Pe,$ as qe,a0 as We,a1 as de,a2 as Ke,T as Ue,c as Ve,n as Ze,o as Je,a3 as Xe,p as Ye,a4 as ue,a5 as me,a6 as ze}from"./index-CrTzx7lV.js";import{E as ge}from"./lists-D2nT8c_k.js";import{C as be,E as Ge,a as Qe,H as et}from"./history-nav-B1PYzRTD.js";import{u as ee}from"./useTranslation-BIN0YLdV.js";const Ie=e=>{const[i]=De();if(!i.has("id"))return 0;const o=i.get("id");let r=typeof o=="string"?+o:0;const d=pe(e);return r&&!isNaN(r)&&d.includes(r)?r:0},tt=e=>{const i=e.map(o=>o.depth);return Math.min(...i)},st=e=>{const i=tt(e);return e.map(r=>(r.depth=r.depth-i,r))},nt=[A.Down,A.Right,A.Up,A.Left],it=[A.Left,A.Right],at=(e,i,o)=>(r,{currentCoordinates:d,context:{active:n,over:a,collisionRect:u,droppableRects:p,droppableContainers:I}})=>{if(nt.includes(r.code)){if(!n||!u)return;r.preventDefault();const{current:{items:x,offset:S}}=e;if(it.includes(r.code)&&(a!=null&&a.id)){const{depth:l,maxDepth:b,minDepth:f}=se(x,n.id,a.id,S,o);switch(r.code){case A.Left:if(l>f)return{...d,x:d.x-o};break;case A.Right:if(l<b)return{...d,x:d.x+o};break}return}const L=[];I.forEach(l=>{if(l!=null&&l.disabled||l.id===(a==null?void 0:a.id))return;const b=p.get(l.id);if(b)switch(r.code){case A.Down:u.top<b.top&&L.push(l);break;case A.Up:u.top>b.top&&L.push(l);break}});const N=ve({collisionRect:u,droppableRects:p,droppableContainers:L});let g=Le(N,"id");if(g===(a==null?void 0:a.id)&&N.length>1&&(g=N[1].id),g&&(a!=null&&a.id)){const l=p.get(n.id),b=p.get(g),f=I.get(g);if(l&&b&&f){const h=x.findIndex(({id:M})=>M===g),w=x[h],H=x.findIndex(({id:M})=>M===n.id),T=x[H];if(w&&T){const{depth:M}=se(x,n.id,g,(w.depth-T.depth)*o,o),k=h>H?1:-1,D=i?(u.height-l.height)/2:0;return{x:b.left+M*o,y:b.top+k*D}}}}}};var te={exports:{}};/*!
	Copyright (c) 2018 Jed Watson.
	Licensed under the MIT License (MIT), see
	http://jedwatson.github.io/classnames
*/var fe;function ot(){return fe||(fe=1,function(e){(function(){var i={}.hasOwnProperty;function o(){for(var n="",a=0;a<arguments.length;a++){var u=arguments[a];u&&(n=d(n,r(u)))}return n}function r(n){if(typeof n=="string"||typeof n=="number")return n;if(typeof n!="object")return"";if(Array.isArray(n))return o.apply(null,n);if(n.toString!==Object.prototype.toString&&!n.toString.toString().includes("[native code]"))return n.toString();var a="";for(var u in n)i.call(n,u)&&n[u]&&(a=d(a,u));return a}function d(n,a){return a?n?n+" "+a:n+a:n}e.exports?(o.default=o,e.exports=o):window.classNames=o})()}(te)),te.exports}var rt=ot();const Q=Ne(rt),lt="_Action_4wa11_1",ct={Action:lt},ae=m.forwardRef(({active:e,className:i,cursor:o,style:r,...d},n)=>t.jsx("button",{ref:n,...d,className:"btn-handle "+Q(ct.Action,i),tabIndex:0,style:{...r,cursor:o,"--fill":e==null?void 0:e.fill,"--background":e==null?void 0:e.background}})),ye=m.forwardRef((e,i)=>t.jsx(ae,{ref:i,cursor:"grab","data-cypress":"draggable-handle",...e}));function dt(e){return t.jsx(ae,{...e,active:{fill:"rgba(255, 70, 70, 0.95)",background:"rgba(255, 70, 70, 0.1)"},children:t.jsx("svg",{width:"8",viewBox:"0 0 22 22",xmlns:"http://www.w3.org/2000/svg",children:t.jsx("path",{d:"M2.99998 -0.000206962C2.7441 -0.000206962 2.48794 0.0972617 2.29294 0.292762L0.292945 2.29276C-0.0980552 2.68376 -0.0980552 3.31682 0.292945 3.70682L7.58591 10.9998L0.292945 18.2928C-0.0980552 18.6838 -0.0980552 19.3168 0.292945 19.7068L2.29294 21.7068C2.68394 22.0978 3.31701 22.0978 3.70701 21.7068L11 14.4139L18.2929 21.7068C18.6829 22.0978 19.317 22.0978 19.707 21.7068L21.707 19.7068C22.098 19.3158 22.098 18.6828 21.707 18.2928L14.414 10.9998L21.707 3.70682C22.098 3.31682 22.098 2.68276 21.707 2.29276L19.707 0.292762C19.316 -0.0982383 18.6829 -0.0982383 18.2929 0.292762L11 7.58573L3.70701 0.292762C3.51151 0.0972617 3.25585 -0.000206962 2.99998 -0.000206962Z"})})})}const ut="_Wrapper_1ubmq_31",mt="_fadeIn_1ubmq_38",ft="_dragOverlay_1ubmq_42",ht="_Item_1ubmq_50",pt="_withHandle_1ubmq_78",xt="_dragging_1ubmq_83",gt="_disabled_1ubmq_92",bt="_color_1ubmq_110",It="_Remove_1ubmq_125",yt="_Actions_1ubmq_135",R={Wrapper:ut,fadeIn:mt,dragOverlay:ft,Item:ht,withHandle:pt,dragging:xt,disabled:gt,color:bt,Remove:It,Actions:yt};oe.memo(oe.forwardRef(({color:e,dragOverlay:i,dragging:o,disabled:r,fadeIn:d,handle:n,handleProps:a,height:u,index:p,listeners:I,onRemove:x,renderItem:S,sorting:L,style:N,transition:g,transform:l,value:b,wrapperStyle:f,...h},w)=>(m.useEffect(()=>{if(i)return document.body.style.cursor="grabbing",()=>{document.body.style.cursor=""}},[i]),S?S({dragOverlay:!!i,dragging:!!o,sorting:!!L,index:p,fadeIn:!!d,listeners:I,ref:w,style:N,transform:l,transition:g,value:b}):t.jsx("li",{className:Q(R.Wrapper,d&&R.fadeIn,L&&R.sorting,i&&R.dragOverlay),style:{...f,transition:[g,f==null?void 0:f.transition].filter(Boolean).join(", "),"--translate-x":l?`${Math.round(l.x)}px`:void 0,"--translate-y":l?`${Math.round(l.y)}px`:void 0,"--scale-x":l!=null&&l.scaleX?`${l.scaleX}`:void 0,"--scale-y":l!=null&&l.scaleY?`${l.scaleY}`:void 0,"--index":p,"--color":e},ref:w,children:t.jsxs("div",{className:Q(R.Item,o&&R.dragging,n&&R.withHandle,i&&R.dragOverlay,r&&R.disabled,e&&R.color),style:N,"data-cypress":"draggable-item",...n?void 0:I,...h,tabIndex:n?void 0:0,children:[b,t.jsxs("span",{className:R.Actions,children:[x?t.jsx(dt,{className:R.Remove,onClick:x}):null,n?t.jsx(ye,{...a,...I}):null]})]})}))));const jt="_Wrapper_14dj2_1",Ct="_clone_14dj2_7",Dt="_TreeItem_14dj2_14",vt="_ghost_14dj2_23",Lt="_indicator_14dj2_24",Nt="_Text_14dj2_95",_t="_Count_14dj2_100",wt="_disableInteraction_14dj2_116",St="_disableSelection_14dj2_120",Tt="_Collapse_14dj2_129",kt="_collapsed_14dj2_134",$={Wrapper:jt,clone:Ct,TreeItem:Dt,ghost:vt,indicator:Lt,Text:Nt,Count:_t,disableInteraction:wt,disableSelection:St,Collapse:Tt,collapsed:kt};function Et(...e){return i=>{Rt(i,...e)}}function Rt(e,...i){i.forEach(o=>{typeof o=="function"?o(e):o!=null&&(o.current=e)})}const $t=m.forwardRef(({childCount:e,clone:i,depth:o,disableSelection:r,disableInteraction:d,ghost:n,handleProps:a,indentationWidth:u,indicator:p,collapsed:I,onCollapse:x,onRemove:S,onNavigate:L,style:N,id:g,type:l,newListItem:b,value:f,textFormat:h,wrapperRef:w,...H},T)=>{const M=ie(),{editMode:C}=m.useContext(ge),{t:k}=ee(["common"]),D=m.useRef(null),[F,B]=m.useState(!1),P=f;let O="";typeof h=="number"&&(h===2?O=" h3":h===3&&(O=" h5"));const q=g,K=()=>{D.current&&(D.current.textContent=P),B(!0)},J=c=>{var y;(y=c.relatedTarget)!=null&&y.className.includes("edit-item-id-"+q)?s():D.current&&(D.current.textContent=P),B(!1)},v=c=>{c.key==="Enter"&&(c.preventDefault(),s(),D.current&&D.current.blur())},s=()=>{if(D.current){const c=D.current.textContent;typeof c=="string"&&c.trim()!==""?M(_e({type:l,id:g,text:c.trim()})):D.current.textContent=P}};return t.jsx("li",{className:"tree-list-item "+Q($.Wrapper,i&&$.clone,n&&$.ghost,p&&$.indicator,r&&$.disableSelection,d&&$.disableInteraction),ref:Et(w,b),style:{"--spacing":`${u*o}px`},...H,children:t.jsxs("div",{className:"tree-item "+$.TreeItem,ref:T,style:N,children:[C&&t.jsxs("div",{className:"tree-item-actions",children:[t.jsx(G,{to:"/?type="+l+"&id="+g,className:"item-nav-link","aria-label":k("go-to-item-id",{id:g}),onClick:L,children:t.jsx("span",{className:"sr-only",children:k("go-to-item-id",{id:g})})}),t.jsx(ye,{...a}),x&&t.jsx(ae,{onClick:x,className:Q($.Collapse,I&&$.collapsed),children:Mt})]}),C&&t.jsx("div",{className:$.Text+O+" edit-mode",ref:D,contentEditable:"plaintext-only",onFocus:K,onBlur:J,onKeyDown:v,suppressContentEditableWarning:!0,role:"textbox",children:f}),!C&&t.jsx("div",{className:$.Text+O+" view-mode",children:f}),i&&e&&e>1?t.jsx("span",{className:$.Count,children:e}):null,!i&&C&&t.jsx("button",{type:"button",className:`edit-item edit-item-id-${q} ${F?"visible":"hide"}`,tabIndex:0,"aria-label":k("edit-list-item"),title:k("save-list-item"),onClick:s}),!i&&C&&t.jsx("button",{type:"button",className:"delete-item",tabIndex:0,onClick:S,"aria-label":k("delete-list-item"),title:k("delete-list-item")})]})})}),Mt=t.jsx("svg",{width:"10",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 70 41",children:t.jsx("path",{d:"M30.76 39.2402C31.885 40.3638 33.41 40.995 35 40.995C36.59 40.995 38.115 40.3638 39.24 39.2402L68.24 10.2402C69.2998 9.10284 69.8768 7.59846 69.8494 6.04406C69.822 4.48965 69.1923 3.00657 68.093 1.90726C66.9937 0.807959 65.5106 0.178263 63.9562 0.150837C62.4018 0.123411 60.8974 0.700397 59.76 1.76024L35 26.5102L10.24 1.76024C9.10259 0.700397 7.59822 0.123411 6.04381 0.150837C4.4894 0.178263 3.00632 0.807959 1.90702 1.90726C0.807714 3.00657 0.178019 4.48965 0.150593 6.04406C0.123167 7.59846 0.700153 9.10284 1.75999 10.2402L30.76 39.2402Z"})}),At=({isSorting:e,wasDragging:i})=>!(e||i);function he({id:e,type:i,newListItem:o,depth:r,...d}){const{attributes:n,isDragging:a,isSorting:u,listeners:p,setDraggableNodeRef:I,setDroppableNodeRef:x,transform:S,transition:L}=we({id:e,animateLayoutChanges:At}),N={transform:ne.Translate.toString(S),transition:L};return t.jsx($t,{id:e,type:i,newListItem:o,ref:I,wrapperRef:x,style:N,depth:r,ghost:a,disableSelection:Se,disableInteraction:u,handleProps:{...n,...p},...d})}const Ht=e=>{const i=m.useContext(be),o=m.useRef(null),{t:r}=ee("common");let d="/?type="+e.type;e.id>0&&(d+="&id="+e.id);const n=a=>{var u,p,I;a.preventDefault(),(u=i.container)!=null&&u.current&&!i.container.current.classList.contains("show")&&(p=i.collapseLink)!=null&&p.current&&i.collapseLink.current.click(),(I=i.listItemInput)!=null&&I.current&&i.listItemInput.current.focus(),o.current&&(o.current.style.cssText="display: none;")};return t.jsx("div",{className:"tree-footer-nav",children:t.jsx(G,{className:"add-item",to:d,onClick:n,ref:o,title:r("add-item"),"aria-label":r("add-item"),children:t.jsx("span",{className:"sr-only",children:r("add-item")})})})},Ft={droppable:{strategy:Re.Always}},Ot={keyframes({transform:e}){return[{opacity:1,transform:ne.Transform.toString(e.initial)},{opacity:0,transform:ne.Transform.toString({...e.final,x:e.final.x+5,y:e.final.y+5})}]},easing:"ease-out",sideEffects({active:e}){e.node.animate([{opacity:0},{opacity:1}],{duration:de.duration,easing:de.easing})}};function Bt(e){const i=(e==null?void 0:e.collapsible)||!1,o=(e==null?void 0:e.indicator)||!1,r=(e==null?void 0:e.indentationWidth)||50,[d,n]=m.useState(e.treeItems),[a,u]=m.useState(null),[p,I]=m.useState(null),[x,S]=m.useState(0),[L,N]=m.useState(null),g=ie(),l=Ie(Z(d)),b=l>0?" parent-list":"",f=m.useMemo(()=>{let s=Z(d);if(l>0){const j=pe(re(s,l));s=s.filter(_=>j.includes(+_.id)),s=st(s)}const y=s.filter(j=>j.collapsed&&j.hasChildren).map(j=>j.id);return Te(s,a!=null?[a,...y]:y)},[a,d,l]),h=a&&p?se(f,a,p,x,r):null,w=m.useRef({items:f,offset:x}),[H]=m.useState(()=>at(w,o,r)),T=ke(le(We),le(qe,{coordinateGetter:H})),M=m.useMemo(()=>f.map(({id:s})=>s),[f]),C=a?f.find(({id:s})=>s===a):null;m.useEffect(()=>{w.current={items:f,offset:x}},[f,x]);const k={onDragStart({active:s}){return`Picked up ${s.id}.`},onDragMove({active:s,over:c}){return v("onDragMove",s.id,c==null?void 0:c.id)},onDragOver({active:s,over:c}){return v("onDragOver",s.id,c==null?void 0:c.id)},onDragEnd({active:s,over:c}){return v("onDragEnd",s.id,c==null?void 0:c.id)},onDragCancel({active:s}){return`Moving was cancelled. ${s.id} was dropped in its original position.`}};return t.jsxs(Ee,{accessibility:{announcements:k},sensors:T,collisionDetection:$e,measuring:Ft,onDragStart:D,onDragMove:F,onDragOver:B,onDragEnd:P,onDragCancel:O,children:[f.length>0&&t.jsx("ul",{className:"tree-list-tree list-group list-group-flush"+b,children:t.jsxs(Me,{items:M,strategy:He,children:[f.map(({id:s,text:c,textFormat:y,collapsed:j,hasChildren:_,depth:X})=>t.jsx(he,{id:s,type:e.type,newListItem:s===e.latestListItemID?e.newListItem:null,value:c,textFormat:y,depth:s===a&&h?h.depth:X,indentationWidth:r,indicator:o,collapsed:!!(j&&_),onCollapse:i&&_?()=>J(s):void 0,onRemove:()=>K(s),onNavigate:e.handleNavigate},s)),Ae.createPortal(t.jsx(Fe,{dropAnimation:Ot,modifiers:o?[Pt]:void 0,children:a&&C?t.jsx(he,{id:a,type:e.type,newListItem:null,depth:C.depth,clone:!0,childCount:Oe(d,a)+1,value:C.text.toString(),textFormat:Number(C.textFormat),indentationWidth:r}):null}),document.body)]})}),!f.length&&t.jsx(Ht,{type:e.type,id:l})]});function D({active:{id:s}}){u(s),I(s);const c=f.find(({id:y})=>y===s);c&&N({parentID:c.parentID,overID:s}),document.body.style.setProperty("cursor","grabbing")}function F({delta:s}){S(s.x)}function B({over:s}){I((s==null?void 0:s.id)??null)}function P({active:s,over:c}){if(q(),h&&c){let{depth:y,parentID:j}=h;const _=Z(d),X=_.findIndex(({id:z})=>z===c.id),W=_.findIndex(({id:z})=>z===s.id),U=_[W];l>0&&j===null&&(j=l),_[W]={...U,depth:y,parentID:j};const V=ce(_,W,X),Y=xe(V);n(Y),e.handleDragUpdate(Z(Y))}}function O(){q()}function q(){I(null),u(null),S(0),N(null),document.body.style.setProperty("cursor","")}function K(s){const j=[...re(f,s).map(_=>Number(_.id)),Number(s)];g(Be({ids:j,type:e.type}))}function J(s){const c=Pe([...d],s,"collapsed",y=>!y);n(c)}function v(s,c,y){if(y&&h){if(s!=="onDragEnd"){if(L&&h.parentID===L.parentID&&y===L.overID)return;N({parentID:h.parentID,overID:y})}const j=JSON.parse(JSON.stringify(Z(d))),_=j.findIndex(({id:E})=>E===y),X=j.findIndex(({id:E})=>E===c),W=ce(j,X,_),U=W[_-1];let V;const Y=s==="onDragEnd"?"dropped":"moved",z=s==="onDragEnd"?"dropped":"nested";if(U)if(h.depth>U.depth)V=`${c} was ${z} under ${U.id}.`;else{let E=U;for(;E&&h.depth<E.depth;){const je=E.parentID;E=W.find(({id:Ce})=>Ce===je)}E&&(V=`${c} was ${Y} after ${E.id}.`)}else{const E=W[_+1];E&&(V=`${c} was ${Y} before ${E.id}.`)}return V}}}const Pt=({transform:e})=>({...e,y:e.y-25}),qt=e=>{const{t:i}=ee("common"),o=Z(e.items);let r=[];e.topLevelID>0&&(r=Ke(o,e.topLevelID));const d=r.length>0?" visible":"";return t.jsx("div",{className:"tree-nav"+d,children:r.length>0&&t.jsx("nav",{style:{"--bs-breadcrumb-divider":"'>'"},"aria-label":"breadcrumb",children:t.jsxs("ol",{className:"breadcrumb",children:[r.length>0&&t.jsx("li",{className:"breadcrumb-item home",children:t.jsx(G,{className:"tree-home",to:"/?type="+e.type,onClick:e.clearHistory,children:t.jsx("span",{className:"sr-only",children:i("home")})})},1),r.length>0&&r.reverse().map((n,a)=>e.topLevelID!==n.id?t.jsx("li",{className:"breadcrumb-item",children:t.jsx(G,{to:"/?type="+e.type+"&id="+n.id,onClick:e.clearHistory,children:n.text})},a+2):t.jsx("li",{className:"breadcrumb-item active","aria-current":"page",children:n.text},a+2))]})})})},Zt=()=>{const e=ie(),{t:i}=ee("common"),{editMode:o}=m.useContext(ge),r=o?" edit-mode":" view-mode",d=m.useContext(Ue),n=d.type,a=Ve(v=>v.lists),u=Ze(n,a),p=u.length,I=Je(u),x=xe(u),S=window.matchMedia("(prefers-reduced-motion: reduce)"),L=!S||S.matches?"instant":"smooth",N=m.useRef(L),g=m.useRef(!1),l=m.useRef(!1),b=m.useRef(!1),f=m.useRef(null),h=m.useRef(null),w=m.useRef(null),H=m.useRef(null),T=m.useRef(null),M={collapseLink:f,listItemInput:h,container:H},C=Ie(u);let k="";if(C>0){const v=Xe(u,C);k=v?v.text:""}let D=Ye(u);const{historyState:F,setHistory:B,resetHistory:P}=D;b.current&&(P(u),b.current=!1),m.useEffect(()=>{l.current&&(e(ue({type:n,items:F})),l.current=!1)},[me(F)]),m.useEffect(()=>{F.length!==p&&B(u),g.current&&T.current!==null&&(T.current.scrollIntoView({behavior:N.current}),T.current.classList.add("new-list-item"),setTimeout(function(){T.current!==null&&T.current.classList.remove("new-list-item"),T.current=null},1e3)),g.current=!1},[p]);const O=v=>{if(v.preventDefault(),h.current&&w.current){let s=null;C>0&&(s=C),e(ze({type:n,item:{id:0,text:h.current.value,collapsed:!1,parentID:s,depth:0,index:0,hasChildren:!1,textFormat:parseInt(w.current.value,10)}})),h.current.value="",w.current.value="1",g.current=!0}else alert(i("invalid-list-item-try-again"))},q=v=>{v(),l.current=!0},K=()=>{b.current=!0},J=v=>{B(v),e(ue({type:n,items:v}))};return t.jsx(be.Provider,{value:M,children:t.jsxs("div",{className:"tree-lists"+r,children:[t.jsx("div",{className:"list-item-form",children:t.jsxs("form",{className:"app-form",onSubmit:O,children:[t.jsx("h1",{children:d.title}),d.description&&t.jsx("p",{className:"type-desc",children:d.description}),t.jsxs("ul",{className:"nav sub-navigation",children:[t.jsx("li",{children:t.jsx(Ge,{})}),o&&t.jsxs(t.Fragment,{children:[t.jsx("li",{className:"nav-item",children:t.jsx(G,{className:"nav-link nav-settings",to:"/settings?type="+n,children:i("settings")})}),t.jsx("li",{children:t.jsx(Qe,{listItemCount:p})})]})]}),o&&t.jsxs("div",{className:"form-group collapse",id:"form-collapse",ref:H,children:[t.jsxs("div",{className:"form-section",children:[t.jsx("label",{htmlFor:"list-item-text",className:"form-label",children:i("list-item")}),t.jsx("input",{type:"text",id:"list-item-text",className:"form-control",name:"listItemText",ref:h,required:!0})]}),t.jsxs("div",{className:"form-section",children:[t.jsx("label",{htmlFor:"textFormat",className:"form-label",children:"Text Format"}),t.jsxs("select",{id:"textFormat",className:"form-select",name:"textFormat",defaultValue:"1",ref:w,children:[t.jsx("option",{value:"1",children:"normal"}),t.jsx("option",{value:"2",children:"heading 1"}),t.jsx("option",{value:"3",children:"heading 2"})]})]}),t.jsx("div",{className:"form-section",children:t.jsx("button",{type:"submit",className:"btn btn-success",children:i("add-list-item")})})]})]})}),t.jsx("div",{className:"list-nav",children:o&&t.jsxs(t.Fragment,{children:[t.jsx(qt,{items:x,topLevelID:C,type:n,clearHistory:K}),t.jsx(et,{updateHistory:q,history:D})]})}),k&&t.jsx("p",{className:"h3",children:k}),p>0&&t.jsx(Bt,{treeItems:x,type:n,newListItem:T,latestListItemID:I,handleDragUpdate:J,handleNavigate:K},me(u)),p===0&&t.jsx("div",{className:"tree-nav",children:t.jsx("p",{children:i("there-are-no-list-items-yet")})})]})})};export{Zt as default};
