import{j as t,d as L,F as H,i as T,c as R,r as l,R as F,e as P,f as B,T as W,b as q,h as A,k as K,l as M,m as V,n as $,L as Q,o as U}from"./index-BfBiGaou.js";import{C as z,a as G,H as J}from"./history-nav-D3W2ccxX.js";import{u as D}from"./useTranslation-B5ErjXyI.js";const O=e=>{const{t:s}=D("date-lists"),r=(n,a)=>{if(n.preventDefault(),!(e.dateInput&&e.dateInput.current))return;let u="";if(["plus_day","plus_month"].includes(a.type)){const m=a.type.split("_");u=L(a.value,m[1],e.dateInput.current.value)}else u=L(a.value,a.type);e.dateInput.current.value=u,e.dateInput.current.focus(),e.setDate(u)},i=[{value:0,type:"day",i18n:s("intlRelativeTime-day-auto",{val:0})},{value:1,type:"day",i18n:s("intlRelativeTime-day",{val:1})},{value:2,type:"day",i18n:s("day-WithCount_other",{count:2})}];for(let n=3;n<15;n++)i.push({value:n,type:"day",i18n:n});i.push.apply(i,[{value:1,type:"plus_day",i18n:s("plus-day-WithCount_one",{count:1})},{value:7,type:"plus_day",i18n:s("plus-day-WithCount_other",{count:7})},{value:1,type:"month",i18n:s("intlRelativeTime-month",{val:1})},{value:2,type:"month",i18n:s("month-WithCount_other",{count:2})},{value:3,type:"month",i18n:3},{value:4,type:"month",i18n:4},{value:5,type:"month",i18n:5},{value:6,type:"month",i18n:6},{value:1,type:"plus_month",i18n:s("plus-month-WithCount_one",{count:1})}]);let o=[],c="day";return i.forEach((n,a)=>{const u=n.type;u!==c&&!u.includes("plus")&&(o.push(t.jsx("br",{},"br"+a)),c=u),o.push(t.jsx("button",{type:"button",onClick:m=>r(m,n),className:"btn btn-outline-dark",children:n.i18n},a))}),t.jsx("div",{className:"date-buttons",children:t.jsxs("details",{children:[t.jsxs("summary",{className:"form-label",children:[" ",s("pick-a-date")]}),t.jsx("small",{id:"date-buttons-help",className:"form-text text-muted",children:s("quickly-pick-a-date-with-the-buttons-below")}),o]})})},X=e=>{const s=H(e.date,e.settings.settings),r=e.settings.settings.pastDateColor,i=e.settings.settings.usePastDateColor,o=e.dateType==="past";let c={};o&&i&&T(r)&&(c={color:r});const n=e.settings.settings.todayDateColor,a=e.settings.settings.useTodayDateColor;return e.dateType==="today"&&a&&T(n)&&(c={color:n}),t.jsx("div",{className:"list-item-date",style:c,children:s})},Y=e=>{const s=R(),{t:r}=D("date-lists"),i=l.useRef(null),[o,c]=l.useState(!1),n=e.item.text,a=e.item.id,u=()=>{i.current&&(i.current.textContent=n),c(!0)},m=d=>{var h;(h=d.relatedTarget)!=null&&h.className.includes("edit-item-id-"+a)?v():i.current&&(i.current.textContent=n),c(!1)},g=d=>{d.key==="Enter"&&(d.preventDefault(),v(),i.current&&i.current.blur())},j=d=>{s(B({ids:[e.item.id],type:e.settings.type}))},v=()=>{if(i.current){const d=i.current.textContent;typeof d=="string"&&d.trim()!==""?s(P({type:e.settings.type,id:e.item.id,text:d.trim()})):i.current.textContent=n}};let y="";return e.settings.settings.usePastDateColor&&(y=F(e.item.date)),t.jsxs("li",{className:"list-group-item "+y,ref:e.newListItem,children:[t.jsxs("div",{className:"list-item",children:[t.jsx("div",{ref:i,className:"list-item-text",contentEditable:"plaintext-only",onFocus:u,onBlur:m,onKeyDown:g,suppressContentEditableWarning:!0,role:"textbox",children:n}),t.jsx(X,{date:e.item.date,settings:e.settings,dateType:y})]}),t.jsx("button",{type:"button",className:`edit-item edit-item-id-${a} ${o?"visible":"hide"}`,tabIndex:0,"aria-label":r("edit-list-item"),title:r("save-list-item"),onClick:v}),t.jsx("button",{type:"button",className:"delete-item",tabIndex:0,"aria-label":r("delete-list-item"),title:r("delete-list-item"),onClick:j})]},e.item.id)},Z=e=>{const s=e.listItems.length;return t.jsx("ul",{className:"list-group list-group-flush",children:s>0&&e.listItems.map(r=>t.jsx(Y,{item:r,settings:e.settings,newListItem:r.id===e.latestListItemID?e.newListItem:null},r.id))})},it=()=>{const e=R(),{t:s}=D("date-lists"),[r,i]=l.useState(""),o=l.useContext(W),c=o.type,n=q(p=>p.lists),a=A(c,n),u=K(a),m=a.length,g=window.matchMedia("(prefers-reduced-motion: reduce)"),j=!g||g.matches?"instant":"smooth",v=l.useRef(j),y=l.useRef(!1),d=l.useRef(!1),h=l.useRef(null),f=l.useRef(null),x=l.useRef(null),N=l.useRef(null),w=l.useRef(null),I=l.useRef(null),k={collapseLink:w,listItemInput:h,container:N},C=M(a),{historyState:b,setHistory:E}=C;l.useEffect(()=>{d.current&&(e(V({type:c,items:b})),d.current=!1)},[b.length]),l.useEffect(()=>{b.length!==m&&E(a),y.current&&x.current!==null&&(x.current.scrollIntoView({behavior:v.current}),x.current.classList.add("new-list-item"),setTimeout(function(){x.current!==null&&x.current.classList.remove("new-list-item"),x.current=null},1e3)),y.current=!1},[m]);const S=p=>{p.preventDefault(),h.current&&f.current?(e(U({type:c,item:{id:0,text:h.current.value,date:f.current.value}})),h.current.value="",f.current.value="",y.current=!0):alert(s("invalid-list-item-try-again"))},_=p=>{p(),d.current=!0};return l.useEffect(()=>{!f.current||!I.current||(I.current.innerHTML=$(f.current.value))},[r]),t.jsx(z.Provider,{value:k,children:t.jsxs("div",{className:"date-lists",children:[t.jsx("div",{className:"list-item-form",children:t.jsxs("form",{className:"app-form",onSubmit:S,children:[t.jsx("h1",{children:o.title}),o.description&&t.jsx("p",{className:"type-desc",children:o.description}),t.jsxs("ul",{className:"nav sub-navigation",children:[t.jsx("li",{className:"nav-item",children:t.jsx(Q,{className:"nav-link nav-settings",to:"/settings?type="+c,children:s("settings")})}),t.jsx("li",{children:t.jsx(G,{listItemCount:m})})]}),t.jsxs("div",{className:"form-group collapse",id:"form-collapse",ref:N,children:[t.jsxs("div",{className:"form-section",children:[t.jsx("label",{htmlFor:"list-item-text",className:"form-label",children:s("list-item")}),t.jsx("input",{type:"text",id:"list-item-text",className:"form-control",name:"listItemText",ref:h,required:!0})]}),t.jsxs("div",{className:"form-section",children:[t.jsx("label",{htmlFor:"list-item-date",className:"form-label",children:s("list-item-date")}),t.jsxs("div",{className:"date-container",children:[t.jsx("input",{type:"date",id:"list-item-date",className:"form-control",name:"listItemDate",ref:f,onChange:p=>i(p.target.value),required:!0}),t.jsx("p",{className:"date-preview",ref:I})]})]}),t.jsx("div",{className:"form-section",children:t.jsx(O,{dateInput:f,setDate:i})}),t.jsx("div",{className:"form-section",children:t.jsx("button",{type:"submit",className:"btn btn-success",children:s("add-list-item")})})]})]})}),t.jsx("div",{className:"list-nav",children:t.jsx(J,{updateHistory:_,history:C})}),t.jsx(Z,{listType:c,settings:o,listItems:a,newListItem:x,latestListItemID:u}),m===0&&t.jsx("p",{children:s("there-are-no-list-items-yet")})]})})};export{it as default};
