import{b as Ce,w as pe,K as H,x as se,y as De,z as ve,A as Le,r as d,j as t,B as oe,e as ie,L as z,l as _e,C as Ne,D as ne,E as we,G as Z,H as le,I as Se,J as Te,M as re,N as ke,O as Re,P as Ee,S as $e,Q as Ae,U as He,V as Oe,W as Be,X as ce,Y as xe,m as Me,Z as Pe,$ as qe,a0 as Fe,a1 as de,a2 as We,T as Ke,c as Ue,n as Ve,o as Ze,a3 as Je,p as Xe,a4 as ue,a5 as me,a6 as Ye}from"./index-BgJmiPEj.js";import{C as ge,a as ze,H as Ge}from"./history-nav-Clmk5B-G.js";import{u as Q}from"./useTranslation-CLo4Ors8.js";const Ie=e=>{const[i]=Ce();if(!i.has("id"))return 0;const l=i.get("id");let o=typeof l=="string"?+l:0;const c=pe(e);return o&&!isNaN(o)&&c.includes(o)?o:0},Qe=e=>{const i=e.map(l=>l.depth);return Math.min(...i)},et=e=>{const i=Qe(e);return e.map(o=>(o.depth=o.depth-i,o))},tt=[H.Down,H.Right,H.Up,H.Left],st=[H.Left,H.Right],nt=(e,i,l)=>(o,{currentCoordinates:c,context:{active:s,over:n,collisionRect:f,droppableRects:I,droppableContainers:b}})=>{if(tt.includes(o.code)){if(!s||!f)return;o.preventDefault();const{current:{items:p,offset:w}}=e;if(st.includes(o.code)&&(n!=null&&n.id)){const{depth:r,maxDepth:g,minDepth:m}=se(p,s.id,n.id,w,l);switch(o.code){case H.Left:if(r>m)return{...c,x:c.x-l};break;case H.Right:if(r<g)return{...c,x:c.x+l};break}return}const C=[];b.forEach(r=>{if(r!=null&&r.disabled||r.id===(n==null?void 0:n.id))return;const g=I.get(r.id);if(g)switch(o.code){case H.Down:f.top<g.top&&C.push(r);break;case H.Up:f.top>g.top&&C.push(r);break}});const D=De({collisionRect:f,droppableRects:I,droppableContainers:C});let x=ve(D,"id");if(x===(n==null?void 0:n.id)&&D.length>1&&(x=D[1].id),x&&(n!=null&&n.id)){const r=I.get(s.id),g=I.get(x),m=b.get(x);if(r&&g&&m){const h=p.findIndex(({id:v})=>v===x),T=p[h],k=p.findIndex(({id:v})=>v===s.id),$=p[k];if(T&&$){const{depth:v}=se(p,s.id,x,(T.depth-$.depth)*l,l),O=h>k?1:-1,B=i?(f.height-r.height)/2:0;return{x:g.left+v*l,y:g.top+O*B}}}}}};var te={exports:{}};/*!
	Copyright (c) 2018 Jed Watson.
	Licensed under the MIT License (MIT), see
	http://jedwatson.github.io/classnames
*/var fe;function it(){return fe||(fe=1,function(e){(function(){var i={}.hasOwnProperty;function l(){for(var s="",n=0;n<arguments.length;n++){var f=arguments[n];f&&(s=c(s,o(f)))}return s}function o(s){if(typeof s=="string"||typeof s=="number")return s;if(typeof s!="object")return"";if(Array.isArray(s))return l.apply(null,s);if(s.toString!==Object.prototype.toString&&!s.toString.toString().includes("[native code]"))return s.toString();var n="";for(var f in s)i.call(s,f)&&s[f]&&(n=c(n,f));return n}function c(s,n){return n?s?s+" "+n:s+n:s}e.exports?(l.default=l,e.exports=l):window.classNames=l})()}(te)),te.exports}var at=it();const G=Le(at),ot="_Action_4wa11_1",lt={Action:ot},ae=d.forwardRef(({active:e,className:i,cursor:l,style:o,...c},s)=>t.jsx("button",{ref:s,...c,className:"btn-handle "+G(lt.Action,i),tabIndex:0,style:{...o,cursor:l,"--fill":e==null?void 0:e.fill,"--background":e==null?void 0:e.background}})),be=d.forwardRef((e,i)=>t.jsx(ae,{ref:i,cursor:"grab","data-cypress":"draggable-handle",...e}));function rt(e){return t.jsx(ae,{...e,active:{fill:"rgba(255, 70, 70, 0.95)",background:"rgba(255, 70, 70, 0.1)"},children:t.jsx("svg",{width:"8",viewBox:"0 0 22 22",xmlns:"http://www.w3.org/2000/svg",children:t.jsx("path",{d:"M2.99998 -0.000206962C2.7441 -0.000206962 2.48794 0.0972617 2.29294 0.292762L0.292945 2.29276C-0.0980552 2.68376 -0.0980552 3.31682 0.292945 3.70682L7.58591 10.9998L0.292945 18.2928C-0.0980552 18.6838 -0.0980552 19.3168 0.292945 19.7068L2.29294 21.7068C2.68394 22.0978 3.31701 22.0978 3.70701 21.7068L11 14.4139L18.2929 21.7068C18.6829 22.0978 19.317 22.0978 19.707 21.7068L21.707 19.7068C22.098 19.3158 22.098 18.6828 21.707 18.2928L14.414 10.9998L21.707 3.70682C22.098 3.31682 22.098 2.68276 21.707 2.29276L19.707 0.292762C19.316 -0.0982383 18.6829 -0.0982383 18.2929 0.292762L11 7.58573L3.70701 0.292762C3.51151 0.0972617 3.25585 -0.000206962 2.99998 -0.000206962Z"})})})}const ct="_Wrapper_1ubmq_31",dt="_fadeIn_1ubmq_38",ut="_dragOverlay_1ubmq_42",mt="_Item_1ubmq_50",ft="_withHandle_1ubmq_78",ht="_dragging_1ubmq_83",pt="_disabled_1ubmq_92",xt="_color_1ubmq_110",gt="_Remove_1ubmq_125",It="_Actions_1ubmq_135",R={Wrapper:ct,fadeIn:dt,dragOverlay:ut,Item:mt,withHandle:ft,dragging:ht,disabled:pt,color:xt,Remove:gt,Actions:It};oe.memo(oe.forwardRef(({color:e,dragOverlay:i,dragging:l,disabled:o,fadeIn:c,handle:s,handleProps:n,height:f,index:I,listeners:b,onRemove:p,renderItem:w,sorting:C,style:D,transition:x,transform:r,value:g,wrapperStyle:m,...h},T)=>(d.useEffect(()=>{if(i)return document.body.style.cursor="grabbing",()=>{document.body.style.cursor=""}},[i]),w?w({dragOverlay:!!i,dragging:!!l,sorting:!!C,index:I,fadeIn:!!c,listeners:b,ref:T,style:D,transform:r,transition:x,value:g}):t.jsx("li",{className:G(R.Wrapper,c&&R.fadeIn,C&&R.sorting,i&&R.dragOverlay),style:{...m,transition:[x,m==null?void 0:m.transition].filter(Boolean).join(", "),"--translate-x":r?`${Math.round(r.x)}px`:void 0,"--translate-y":r?`${Math.round(r.y)}px`:void 0,"--scale-x":r!=null&&r.scaleX?`${r.scaleX}`:void 0,"--scale-y":r!=null&&r.scaleY?`${r.scaleY}`:void 0,"--index":I,"--color":e},ref:T,children:t.jsxs("div",{className:G(R.Item,l&&R.dragging,s&&R.withHandle,i&&R.dragOverlay,o&&R.disabled,e&&R.color),style:D,"data-cypress":"draggable-item",...s?void 0:b,...h,tabIndex:s?void 0:0,children:[g,t.jsxs("span",{className:R.Actions,children:[p?t.jsx(rt,{className:R.Remove,onClick:p}):null,s?t.jsx(be,{...n,...b}):null]})]})}))));const bt="_Wrapper_14dj2_1",yt="_clone_14dj2_7",jt="_TreeItem_14dj2_14",Ct="_ghost_14dj2_23",Dt="_indicator_14dj2_24",vt="_Text_14dj2_95",Lt="_Count_14dj2_100",_t="_disableInteraction_14dj2_116",Nt="_disableSelection_14dj2_120",wt="_Collapse_14dj2_129",St="_collapsed_14dj2_134",E={Wrapper:bt,clone:yt,TreeItem:jt,ghost:Ct,indicator:Dt,Text:vt,Count:Lt,disableInteraction:_t,disableSelection:Nt,Collapse:wt,collapsed:St};function Tt(...e){return i=>{kt(i,...e)}}function kt(e,...i){i.forEach(l=>{typeof l=="function"?l(e):l!=null&&(l.current=e)})}const Rt=d.forwardRef(({childCount:e,clone:i,depth:l,disableSelection:o,disableInteraction:c,ghost:s,handleProps:n,indentationWidth:f,indicator:I,collapsed:b,onCollapse:p,onRemove:w,onNavigate:C,style:D,id:x,type:r,newListItem:g,value:m,wrapperRef:h,...T},k)=>{const $=ie(),{t:v}=Q(["common"]),y=d.useRef(null),[O,B]=d.useState(!1),M=m,F=x,W=()=>{y.current&&(y.current.textContent=M),B(!0)},J=A=>{var K;(K=A.relatedTarget)!=null&&K.className.includes("edit-item-id-"+F)?P():y.current&&(y.current.textContent=M),B(!1)},L=A=>{A.key==="Enter"&&(A.preventDefault(),P(),y.current&&y.current.blur())},P=()=>{if(y.current){const A=y.current.textContent;typeof A=="string"&&A.trim()!==""?$(_e({type:r,id:x,text:A.trim()})):y.current.textContent=M}};return t.jsx("li",{className:"tree-list-item "+G(E.Wrapper,i&&E.clone,s&&E.ghost,I&&E.indicator,o&&E.disableSelection,c&&E.disableInteraction),ref:Tt(h,g),style:{"--spacing":`${f*l}px`},...T,children:t.jsxs("div",{className:"tree-item "+E.TreeItem,ref:k,style:D,children:[t.jsxs("div",{className:"tree-item-actions",children:[t.jsx(z,{to:"/?type="+r+"&id="+x,className:"item-nav-link","aria-label":v("go-to-item-id",{id:x}),onClick:C,children:t.jsx("span",{className:"sr-only",children:v("go-to-item-id",{id:x})})}),t.jsx(be,{...n}),p&&t.jsx(ae,{onClick:p,className:G(E.Collapse,b&&E.collapsed),children:Et})]}),t.jsx("div",{className:E.Text,ref:y,contentEditable:"plaintext-only",onFocus:W,onBlur:J,onKeyDown:L,suppressContentEditableWarning:!0,role:"textbox",children:m}),i&&e&&e>1?t.jsx("span",{className:E.Count,children:e}):null,!i&&t.jsx("button",{type:"button",className:`edit-item edit-item-id-${F} ${O?"visible":"hide"}`,tabIndex:0,"aria-label":v("edit-list-item"),title:v("save-list-item"),onClick:P}),!i&&t.jsx("button",{type:"button",className:"delete-item",tabIndex:0,onClick:w,"aria-label":v("delete-list-item"),title:v("delete-list-item")})]})})}),Et=t.jsx("svg",{width:"10",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 70 41",children:t.jsx("path",{d:"M30.76 39.2402C31.885 40.3638 33.41 40.995 35 40.995C36.59 40.995 38.115 40.3638 39.24 39.2402L68.24 10.2402C69.2998 9.10284 69.8768 7.59846 69.8494 6.04406C69.822 4.48965 69.1923 3.00657 68.093 1.90726C66.9937 0.807959 65.5106 0.178263 63.9562 0.150837C62.4018 0.123411 60.8974 0.700397 59.76 1.76024L35 26.5102L10.24 1.76024C9.10259 0.700397 7.59822 0.123411 6.04381 0.150837C4.4894 0.178263 3.00632 0.807959 1.90702 1.90726C0.807714 3.00657 0.178019 4.48965 0.150593 6.04406C0.123167 7.59846 0.700153 9.10284 1.75999 10.2402L30.76 39.2402Z"})}),$t=({isSorting:e,wasDragging:i})=>!(e||i);function he({id:e,type:i,newListItem:l,depth:o,...c}){const{attributes:s,isDragging:n,isSorting:f,listeners:I,setDraggableNodeRef:b,setDroppableNodeRef:p,transform:w,transition:C}=Ne({id:e,animateLayoutChanges:$t}),D={transform:ne.Translate.toString(w),transition:C};return t.jsx(Rt,{id:e,type:i,newListItem:l,ref:b,wrapperRef:p,style:D,depth:o,ghost:n,disableSelection:we,disableInteraction:f,handleProps:{...s,...I},...c})}const At=e=>{const i=d.useContext(ge),l=d.useRef(null),{t:o}=Q("common");let c="/?type="+e.type;e.id>0&&(c+="&id="+e.id);const s=n=>{var f,I,b;n.preventDefault(),(f=i.container)!=null&&f.current&&!i.container.current.classList.contains("show")&&(I=i.collapseLink)!=null&&I.current&&i.collapseLink.current.click(),(b=i.listItemInput)!=null&&b.current&&i.listItemInput.current.focus(),l.current&&(l.current.style.cssText="display: none;")};return t.jsx("div",{className:"tree-footer-nav",children:t.jsx(z,{className:"add-item",to:c,onClick:s,ref:l,title:o("add-item"),"aria-label":o("add-item"),children:t.jsx("span",{className:"sr-only",children:o("add-item")})})})},Ht={droppable:{strategy:Re.Always}},Ot={keyframes({transform:e}){return[{opacity:1,transform:ne.Transform.toString(e.initial)},{opacity:0,transform:ne.Transform.toString({...e.final,x:e.final.x+5,y:e.final.y+5})}]},easing:"ease-out",sideEffects({active:e}){e.node.animate([{opacity:0},{opacity:1}],{duration:de.duration,easing:de.easing})}};function Bt(e){const i=(e==null?void 0:e.collapsible)||!1,l=(e==null?void 0:e.indicator)||!1,o=(e==null?void 0:e.indentationWidth)||50,[c,s]=d.useState(e.treeItems),[n,f]=d.useState(null),[I,b]=d.useState(null),[p,w]=d.useState(0),[C,D]=d.useState(null),x=ie(),r=Ie(Z(c)),g=r>0?" parent-list":"",m=d.useMemo(()=>{let a=Z(c);if(r>0){const j=pe(le(a,r));a=a.filter(N=>j.includes(+N.id)),a=et(a)}const _=a.filter(j=>j.collapsed&&j.hasChildren).map(j=>j.id);return Se(a,n!=null?[n,..._]:_)},[n,c,r]),h=n&&I?se(m,n,I,p,o):null,T=d.useRef({items:m,offset:p}),[k]=d.useState(()=>nt(T,l,o)),$=Te(re(Fe),re(qe,{coordinateGetter:k})),v=d.useMemo(()=>m.map(({id:a})=>a),[m]),y=n?m.find(({id:a})=>a===n):null;d.useEffect(()=>{T.current={items:m,offset:p}},[m,p]);const O={onDragStart({active:a}){return`Picked up ${a.id}.`},onDragMove({active:a,over:u}){return K("onDragMove",a.id,u==null?void 0:u.id)},onDragOver({active:a,over:u}){return K("onDragOver",a.id,u==null?void 0:u.id)},onDragEnd({active:a,over:u}){return K("onDragEnd",a.id,u==null?void 0:u.id)},onDragCancel({active:a}){return`Moving was cancelled. ${a.id} was dropped in its original position.`}};return t.jsxs(ke,{accessibility:{announcements:O},sensors:$,collisionDetection:Ee,measuring:Ht,onDragStart:B,onDragMove:M,onDragOver:F,onDragEnd:W,onDragCancel:J,children:[m.length>0&&t.jsx("ul",{className:"tree-list-tree list-group list-group-flush"+g,children:t.jsxs($e,{items:v,strategy:He,children:[m.map(({id:a,text:u,collapsed:_,hasChildren:j,depth:N})=>t.jsx(he,{id:a,type:e.type,newListItem:a===e.latestListItemID?e.newListItem:null,value:u,depth:a===n&&h?h.depth:N,indentationWidth:o,indicator:l,collapsed:!!(_&&j),onCollapse:i&&j?()=>A(a):void 0,onRemove:()=>P(a),onNavigate:e.handleNavigate},a)),Ae.createPortal(t.jsx(Oe,{dropAnimation:Ot,modifiers:l?[Mt]:void 0,children:n&&y?t.jsx(he,{id:n,type:e.type,newListItem:null,depth:y.depth,clone:!0,childCount:Be(c,n)+1,value:y.text.toString(),indentationWidth:o}):null}),document.body)]})}),!m.length&&t.jsx(At,{type:e.type,id:r})]});function B({active:{id:a}}){f(a),b(a);const u=m.find(({id:_})=>_===a);u&&D({parentID:u.parentID,overID:a}),document.body.style.setProperty("cursor","grabbing")}function M({delta:a}){w(a.x)}function F({over:a}){b((a==null?void 0:a.id)??null)}function W({active:a,over:u}){if(L(),h&&u){let{depth:_,parentID:j}=h;const N=Z(c),ee=N.findIndex(({id:Y})=>Y===u.id),q=N.findIndex(({id:Y})=>Y===a.id),U=N[q];r>0&&j===null&&(j=r),N[q]={...U,depth:_,parentID:j};const V=ce(N,q,ee),X=xe(V);s(X),e.handleDragUpdate(Z(X))}}function J(){L()}function L(){b(null),f(null),w(0),D(null),document.body.style.setProperty("cursor","")}function P(a){const j=[...le(m,a).map(N=>Number(N.id)),Number(a)];x(Me({ids:j,type:e.type}))}function A(a){const u=Pe([...c],a,"collapsed",_=>!_);s(u)}function K(a,u,_){if(_&&h){if(a!=="onDragEnd"){if(C&&h.parentID===C.parentID&&_===C.overID)return;D({parentID:h.parentID,overID:_})}const j=JSON.parse(JSON.stringify(Z(c))),N=j.findIndex(({id:S})=>S===_),ee=j.findIndex(({id:S})=>S===u),q=ce(j,ee,N),U=q[N-1];let V;const X=a==="onDragEnd"?"dropped":"moved",Y=a==="onDragEnd"?"dropped":"nested";if(U)if(h.depth>U.depth)V=`${u} was ${Y} under ${U.id}.`;else{let S=U;for(;S&&h.depth<S.depth;){const ye=S.parentID;S=q.find(({id:je})=>je===ye)}S&&(V=`${u} was ${X} after ${S.id}.`)}else{const S=q[N+1];S&&(V=`${u} was ${X} before ${S.id}.`)}return V}}}const Mt=({transform:e})=>({...e,y:e.y-25}),Pt=e=>{const{t:i}=Q("common"),l=Z(e.items);let o=[];e.topLevelID>0&&(o=We(l,e.topLevelID));const c=o.length>0?" visible":"";return t.jsx("div",{className:"tree-nav"+c,children:o.length>0&&t.jsx("nav",{style:{"--bs-breadcrumb-divider":"'>'"},"aria-label":"breadcrumb",children:t.jsxs("ol",{className:"breadcrumb",children:[o.length>0&&t.jsx("li",{className:"breadcrumb-item home",children:t.jsx(z,{className:"tree-home",to:"/?type="+e.type,onClick:e.clearHistory,children:t.jsx("span",{className:"sr-only",children:i("home")})})},1),o.length>0&&o.reverse().map((s,n)=>e.topLevelID!==s.id?t.jsx("li",{className:"breadcrumb-item",children:t.jsx(z,{to:"/?type="+e.type+"&id="+s.id,onClick:e.clearHistory,children:s.text})},n+2):t.jsx("li",{className:"breadcrumb-item active","aria-current":"page",children:s.text},n+2))]})})})},Kt=()=>{const e=ie(),{t:i}=Q("common"),l=d.useContext(Ke),o=l.type,c=Ue(L=>L.lists),s=Ve(o,c),n=s.length,f=Ze(s),I=xe(s),b=window.matchMedia("(prefers-reduced-motion: reduce)"),p=!b||b.matches?"instant":"smooth",w=d.useRef(p),C=d.useRef(!1),D=d.useRef(!1),x=d.useRef(!1),r=d.useRef(null),g=d.useRef(null),m=d.useRef(null),h=d.useRef(null),T={collapseLink:r,listItemInput:g,container:m},k=Ie(s);let $="";if(k>0){const L=Je(s,k);$=L?L.text:""}let v=Xe(s);const{historyState:y,setHistory:O,resetHistory:B}=v;x.current&&(B(s),x.current=!1),d.useEffect(()=>{D.current&&(e(ue({type:o,items:y})),D.current=!1)},[me(y)]),d.useEffect(()=>{y.length!==n&&O(s),C.current&&h.current!==null&&(h.current.scrollIntoView({behavior:w.current}),h.current.classList.add("new-list-item"),setTimeout(function(){h.current!==null&&h.current.classList.remove("new-list-item"),h.current=null},1e3)),C.current=!1},[n]);const M=L=>{if(L.preventDefault(),g.current){let P=null;k>0&&(P=k),e(Ye({type:o,item:{id:0,text:g.current.value,collapsed:!1,parentID:P,depth:0,index:0,hasChildren:!1}})),g.current.value="",C.current=!0}else alert(i("invalid-list-item-try-again"))},F=L=>{L(),D.current=!0},W=()=>{x.current=!0},J=L=>{O(L),e(ue({type:o,items:L}))};return t.jsx(ge.Provider,{value:T,children:t.jsxs("div",{className:"tree-lists",children:[t.jsx("div",{className:"list-item-form",children:t.jsxs("form",{className:"app-form",onSubmit:M,children:[t.jsx("h1",{children:l.title}),l.description&&t.jsx("p",{className:"type-desc",children:l.description}),t.jsxs("ul",{className:"nav sub-navigation",children:[t.jsx("li",{className:"nav-item",children:t.jsx(z,{className:"nav-link nav-settings",to:"/settings?type="+o,children:i("settings")})}),t.jsx("li",{children:t.jsx(ze,{listItemCount:n})})]}),t.jsxs("div",{className:"form-group collapse",id:"form-collapse",ref:m,children:[t.jsxs("div",{className:"form-section",children:[t.jsx("label",{htmlFor:"list-item-text",className:"form-label",children:i("list-item")}),t.jsx("input",{type:"text",id:"list-item-text",className:"form-control",name:"listItemText",ref:g,required:!0})]}),t.jsx("div",{className:"form-section",children:t.jsx("button",{type:"submit",className:"btn btn-success",children:i("add-list-item")})})]})]})}),t.jsxs("div",{className:"list-nav",children:[t.jsx(Pt,{items:I,topLevelID:k,type:o,clearHistory:W}),t.jsx(Ge,{updateHistory:F,history:v})]}),$&&t.jsx("h5",{className:"top-level-title",children:$}),n>0&&t.jsx(Bt,{treeItems:I,type:o,newListItem:h,latestListItemID:f,handleDragUpdate:J,handleNavigate:W},me(s)),n===0&&t.jsx("div",{className:"tree-nav",children:t.jsx("p",{children:i("there-are-no-list-items-yet")})})]})})};export{Kt as default};
