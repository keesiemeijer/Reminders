import{e as N,r as c,j as t,i as B,f as P,h as T,F as M,k as E,R as W,l as A,m as q,T as O,c as V,n as $,o as K,p as Q,q as U,t as z,L as G,v as J}from"./index-dKj0z-t1.js";import{C as X,E as Y,a as Z,H as tt}from"./history-nav-Cxhs9TFM.js";import{E as R}from"./lists-DIXC-Y0f.js";import{u as I}from"./useTranslation-Q3H9OjDf.js";const et=e=>{const{t:s}=I("common"),u=N(),a=e.settings,[i,r]=c.useState(a.settings.listSort),n=o=>{const l=i==="ASC"?"DESC":"ASC",h={...a.settings,listSort:l},m={...a,settings:h};B(m)&&u(P(m)),r(l)};return t.jsx("button",{type:"button",className:`sort-button sort-button-${i}`,tabIndex:0,"aria-label":s("sort-list"),title:s("sort-list"),onClick:n})},st=e=>{const{t:s}=I("date-lists"),u=(n,o)=>{if(n.preventDefault(),!(e.dateInput&&e.dateInput.current))return;let l="";if(["plus_day","plus_month"].includes(o.type)){const h=o.type.split("_");l=T(o.value,h[1],e.dateInput.current.value)}else l=T(o.value,o.type);e.dateInput.current.value=l,e.dateInput.current.focus(),e.setDate(l)},a=[{value:0,type:"day",i18n:s("intlRelativeTime-day-auto",{val:0})},{value:1,type:"day",i18n:s("intlRelativeTime-day",{val:1})},{value:2,type:"day",i18n:s("day-WithCount_other",{count:2})}];for(let n=3;n<15;n++)a.push({value:n,type:"day",i18n:n});a.push.apply(a,[{value:1,type:"plus_day",i18n:s("plus-day-WithCount_one",{count:1})},{value:7,type:"plus_day",i18n:s("plus-day-WithCount_other",{count:7})},{value:1,type:"month",i18n:s("intlRelativeTime-month",{val:1})},{value:2,type:"month",i18n:s("month-WithCount_other",{count:2})},{value:3,type:"month",i18n:3},{value:4,type:"month",i18n:4},{value:5,type:"month",i18n:5},{value:6,type:"month",i18n:6},{value:1,type:"plus_month",i18n:s("plus-month-WithCount_one",{count:1})}]);let i=[],r="day";return a.forEach((n,o)=>{const l=n.type;l!==r&&!l.includes("plus")&&(i.push(t.jsx("br",{},"br"+o)),r=l),i.push(t.jsx("button",{type:"button",onClick:h=>u(h,n),className:"btn btn-outline-dark",children:n.i18n},o))}),t.jsx("div",{className:"date-buttons",children:t.jsxs("details",{children:[t.jsxs("summary",{className:"form-label",children:[" ",s("pick-a-date")]}),t.jsx("small",{id:"date-buttons-help",className:"form-text text-muted",children:s("quickly-pick-a-date-with-the-buttons-below")}),i]})})},nt=e=>{const s=M(e.date,e.settings.settings),u=e.settings.settings.pastDateColor,a=e.settings.settings.usePastDateColor,i=e.dateType==="past";let r={};i&&a&&E(u)&&(r={color:u});const n=e.settings.settings.todayDateColor,o=e.settings.settings.useTodayDateColor;return e.dateType==="today"&&o&&E(n)&&(r={color:n}),t.jsx("div",{className:"list-item-date",style:r,children:s})},it=e=>{const s=N(),{t:u}=I(["date-lists","common"]),{editMode:a}=c.useContext(R),i=c.useRef(null),[r,n]=c.useState(!1),o=e.item.text,l=e.item.id,h=()=>{i.current&&(i.current.textContent=o),n(!0)},m=d=>{var x;(x=d.relatedTarget)!=null&&x.className.includes("edit-item-id-"+l)?g():i.current&&(i.current.textContent=o),n(!1)},j=d=>{d.key==="Enter"&&(d.preventDefault(),g(),i.current&&i.current.blur())},b=d=>{s(q({ids:[e.item.id],type:e.settings.type}))},g=()=>{if(i.current){const d=i.current.textContent;typeof d=="string"&&d.trim()!==""?s(A({type:e.settings.type,id:e.item.id,text:d.trim()})):i.current.textContent=o}};let y="";return e.settings.settings.usePastDateColor&&(y=W(e.item.date)),t.jsxs("li",{className:"list-group-item "+y,ref:e.newListItem,children:[t.jsxs("div",{className:"list-item",children:[a&&t.jsx("div",{ref:i,className:"list-item-text",contentEditable:"plaintext-only",onFocus:h,onBlur:m,onKeyDown:j,suppressContentEditableWarning:!0,role:"textbox",children:o}),!a&&t.jsx("div",{className:"list-item-text",children:o}),t.jsx(nt,{date:e.item.date,settings:e.settings,dateType:y})]}),a&&t.jsxs(t.Fragment,{children:[t.jsx("button",{type:"button",className:`edit-item edit-item-id-${l} ${r?"visible":"hide"}`,tabIndex:0,"aria-label":u("edit-list-item",{ns:"common"}),title:u("save-list-item",{ns:"common"}),onClick:g}),t.jsx("button",{type:"button",className:"delete-item",tabIndex:0,"aria-label":u("delete-list-item",{ns:"common"}),title:u("delete-list-item",{ns:"common"}),onClick:b})]})]},e.item.id)},at=e=>{const s=e.listItems.length,u=e.settings.settings.listSort==="DESC"?[...e.listItems].reverse():e.listItems;return t.jsx("ul",{className:"list-group list-group-flush",children:s>0&&u.map(a=>t.jsx(it,{item:a,settings:e.settings,newListItem:a.id===e.latestListItemID?e.newListItem:null},a.id))})},ut=()=>{const e=N(),{t:s}=I(["date-lists","common"]),[u,a]=c.useState(""),{editMode:i}=c.useContext(R),r=c.useContext(O),n=r.type,o=V(v=>v.lists),l=$(n,o),h=K(l),m=l.length,j=window.matchMedia("(prefers-reduced-motion: reduce)"),b=!j||j.matches?"instant":"smooth",g=c.useRef(b),y=c.useRef(!1),d=c.useRef(!1),x=c.useRef(null),f=c.useRef(null),p=c.useRef(null),L=c.useRef(null),w=c.useRef(null),C=c.useRef(null),k={collapseLink:w,listItemInput:x,container:L},S=Q(l),{historyState:D,setHistory:_}=S;c.useEffect(()=>{d.current&&(e(U({type:n,items:D})),d.current=!1)},[D.length]),c.useEffect(()=>{D.length!==m&&_(l),y.current&&p.current!==null&&(p.current.scrollIntoView({behavior:g.current}),p.current.classList.add("new-list-item"),setTimeout(function(){p.current!==null&&p.current.classList.remove("new-list-item"),p.current=null},1e3)),y.current=!1},[m]);const F=v=>{v.preventDefault(),x.current&&f.current?(e(J({type:n,item:{id:0,text:x.current.value,date:f.current.value}})),x.current.value="",f.current.value="",y.current=!0):alert(s("invalid-list-item-try-again",{ns:"common"}))},H=v=>{v(),d.current=!0};return c.useEffect(()=>{!f.current||!C.current||(C.current.innerHTML=z(f.current.value))},[u]),t.jsx(X.Provider,{value:k,children:t.jsxs("div",{className:"date-lists",children:[t.jsx("div",{className:"list-item-form",children:t.jsxs("form",{className:"app-form",onSubmit:F,children:[t.jsx("h1",{children:r.title}),r.description&&t.jsx("p",{className:"type-desc",children:r.description}),t.jsxs("ul",{className:"nav sub-navigation",children:[t.jsx("li",{children:t.jsx(Y,{})}),i&&t.jsxs(t.Fragment,{children:[t.jsx("li",{className:"nav-item",children:t.jsx(G,{className:"nav-link nav-settings",to:"/settings?type="+n,children:s("settings",{ns:"common"})})}),t.jsx("li",{children:t.jsx(Z,{listItemCount:m})})]})]}),i&&t.jsxs("div",{className:"form-group collapse",id:"form-collapse",ref:L,children:[t.jsxs("div",{className:"form-section",children:[t.jsx("label",{htmlFor:"list-item-text",className:"form-label",children:s("list-item",{ns:"common"})}),t.jsx("input",{type:"text",id:"list-item-text",className:"form-control",name:"listItemText",ref:x,required:!0})]}),t.jsxs("div",{className:"form-section",children:[t.jsx("label",{htmlFor:"list-item-date",className:"form-label",children:s("list-item-date")}),t.jsxs("div",{className:"date-container",children:[t.jsx("input",{type:"date",id:"list-item-date",className:"form-control",name:"listItemDate",ref:f,onChange:v=>a(v.target.value),required:!0}),t.jsx("p",{className:"date-preview",ref:C})]})]}),t.jsx("div",{className:"form-section",children:t.jsx(st,{dateInput:f,setDate:a})}),t.jsx("div",{className:"form-section",children:t.jsx("button",{type:"submit",className:"btn btn-success",children:s("add-list-item",{ns:"common"})})})]})]})}),t.jsx("div",{className:"list-nav date-list-nav",children:i&&t.jsxs(t.Fragment,{children:[t.jsx(tt,{updateHistory:H,history:S}),m>1&&t.jsx(et,{settings:r})]})}),t.jsx(at,{listType:n,settings:r,listItems:l,newListItem:p,latestListItemID:h}),m===0&&t.jsx("p",{children:s("there-are-no-list-items-yet",{ns:"common"})})]})})};export{ut as default};
